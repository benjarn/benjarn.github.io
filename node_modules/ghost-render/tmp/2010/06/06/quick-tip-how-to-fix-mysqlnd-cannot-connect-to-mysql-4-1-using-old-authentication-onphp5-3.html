<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Quick tip: how to fix &quot;mysqlnd cannot connect to MySQL 4.1+ using old authentication&quot; onPHP5.3</title>	

	<meta name="description" content="">
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Quick tip: how to fix &quot;mysqlnd cannot connect to MySQL 4.1+ using old authentication&quot; onPHP5.3">
    <meta name="twitter:description" content="">
    <meta name="twitter:site" content="@username">
	<meta name="twitter:creator" content="@username">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Quick tip: how to fix &quot;mysqlnd cannot connect to MySQL 4.1+ using old authentication&quot; onPHP5.3">
    <meta property="og:description" content="">

    <link rel="stylesheet" href="/assets/css/style.css">

    <meta name="generator" content="Ghost ?" />
<link rel="alternate" type="application/rss+xml" title="Mixu&#39;s blog" href="/rss/">
<link rel="canonical" href="http://localhost:5000//2010/06/06/quick-tip-how-to-fix-mysqlnd-cannot-connect-to-mysql-4-1-using-old-authentication-onphp5-3.md" />	
</head>
<body class="post-template">
	
<main id="container" role="main">
	<header class="header" role="banner" style="background-image: url(/assets/img/header.jpg);">
		<h1 class="blog-title">
			<a href="http://localhost:5000">Mixu&#x27;s blog</a>
		</h1>
		<div class="blog-description">A blog</div>
	</header>
	<nav class="menu" role="navigation">
		<a href="#">Home</a>
		<span class="delimiter">&#8226;</span>
		<a href="#">About</a>
		<span class="delimiter">&#8226;</span>
		<a href="#">Contacts</a>
	</nav>
	<section class="post-full">
		<article itemscope itemtype="http://schema.org/BlogPosting" role="article" class="post">
			<header class="post-header">        		
    			<h2 itemprop="name headline" class="post-title">
    				<a href="/2010/06/06/quick-tip-how-to-fix-mysqlnd-cannot-connect-to-mysql-4-1-using-old-authentication-onphp5-3.html" itemprop="url">Quick tip: how to fix &quot;mysqlnd cannot connect to MySQL 4.1+ using old authentication&quot; onPHP5.3</a>
    			</h2>
    			<div class="post-meta">
        			<time datetime="2010-06-06" itemprop="datePublished">June 06, 2010</time>
        		</div>
        		<hr>
    		</header>
    		<section itemprop="articleBody" class="post-content">
    			<p>I recently upgraded to PHP 5.3 on Windows, and ran into this problem:</p>
<pre class="hljs"><code>
Warning: mysql_connect(): OK packet <span class="hljs-number">6</span> bytes shorter than expected <span class="hljs-keyword">in</span> <span class="hljs-keyword">...</span>
Warning: mysql_connect(): mysqlnd cannot connect to MySQL <span class="hljs-number">4.1</span>+ using old authentication <span class="hljs-keyword">in</span> <span class="hljs-keyword">...</span></code></pre><p>I run my Linux servers on VMWare when I do development, so the MySQL database itself was from quite a while ago. As you will see, the core issue here is that MySQL can have passwords with hashes stored in the old 16-character format, which is not supported by PHP 5.3&#39;s new mysqlnd  library.</p>
<p>Since I couldn&#39;t find a good solution with a quick Google, here is how I solved this <strong>without having to downgrade PHP or MySQL</strong> (as some of the solutions suggested):</p>
<p><strong>1. Change MySQL to NOT to use old_passwords </strong></p>
<p>It seems that even MySQL 5.x versions still default to the old password hashes. You need to change this in &quot;my.cnf&quot; (e.g. /etc/my.cnf): remove or comment out the line that says</p>
<pre class="hljs"><code>
<span class="hljs-title">old_passwords</span> = <span class="hljs-number">1</span></code></pre><p>Restart MySQL. If you don&#39;t, MySQL will keep using the old password format, which will mean that you cannot upgrade the passwords using the builtin PASSWORD() hashing function. You can test this by running:</p>
<pre lang="sql">
 SELECT Length(PASSWORD('xyz'));
+-------------------------+
| Length(PASSWORD('xyz')) |
+-------------------------+
|                      16 |
+-------------------------+
1 row in set (0.00 sec)
</pre>

<p>The old password hashes are 16 characters, the new ones are 41 characters.</p>
<p><strong>2. Change the format of all the passwords in the database to the new format</strong></p>
<p>Connect to the database, and run the following query:</p>
<pre lang="sql">
SELECT user,  Length(`Password`) FROM   `mysql`.`user`;
</pre>

<p>This will show you which passwords are in the old format, ex:</p>
<pre lang="sql">
+----------+--------------------+
| user     | Length(`Password`) |
+----------+--------------------+
| root     |                 41 |
| root     |                 16 |
| user2    |                 16 |
| user2    |                 16 |
+----------+--------------------+
</pre>

<p>Notice here that each user can have multiple rows (one for each different host specification).</p>
<p>To update the password for each user, run the following:</p>
<pre lang="sql">
UPDATE mysql.user SET Password = PASSWORD('password') WHERE user = 'username';
</pre>

<p>Finally, flush privileges:</p>
<pre class="hljs"><code>
<span class="hljs-operator"><span class="hljs-keyword">FLUSH</span> <span class="hljs-keyword">PRIVILEGES</span>;</span></code></pre><h2 id="comments">Comments</h2>
<p><strong><a href="#230" title="2010-08-25 02:46:11">mark</a>:</strong> That was a big help - we had some trouble with this same issue today while migrating to a new server. It was not clear why the install worked on the old system but not a very similar new system until we found your post.</p>
<p><strong><a href="#231" title="2010-09-22 04:27:44">Mahbub</a>:</strong> Hey Mixu, That was really a relief from the stupid error. I recently upgraded XAMPP which is 1.7.4 (beta) and php5.3.3. It killed my 1.5 hrs yesterday.</p>
<p>For windows users, please edit [xampp installation dir]mysqlbinmy.ini to set the value  old_passwords = 1</p>
<p><strong><a href="#232" title="2010-11-23 20:59:06">Khupcom</a>:</strong> Oh my God... I&#39;ve been 2 days stuck with this problem and the solution only :
UPDATE mysql.user SET Password = PASSWORD(&#39;mynewpass&#39;) WHERE user = &#39;myusername&#39;;</p>
<p>FLUSH PRIVILEGES;</p>
<p>I just want to say you&#39;re my hero</p>
<p>Really big thanx</p>
<p><strong><a href="#234" title="2011-04-29 22:35:39">Alex</a>:</strong> I did everything you said, and I still get the same error... Something&#39;s wrong lol</p>
<p><strong><a href="#235" title="2011-05-07 15:46:25">Sailesh</a>:</strong> Hey! Mixu.... Thanks man! I took 2 days to find this solution. It helped me a lot. I&#39;ve added your post onto my blog.</p>
<p>Thanks again! :)</p>
<p><strong><a href="#236" title="2011-06-18 01:35:51">neverstopdreaming</a>:</strong> Thanks!</p>
<p><strong><a href="#237" title="2011-08-19 18:03:26">Luis</a>:</strong> How can I change this settings if I&#39;m working in a remote server with their own control panel and phpMyAdmin.  Can I change the setting of MySQL in the remote site?</p>
<p><strong><a href="#238" title="2011-09-12 21:26:56">Adam</a>:</strong> Allelujah. My evening is saved. Thanks!</p>
<p><strong><a href="#240" title="2011-12-20 17:45:36">Pedro</a>:</strong> Thank you</p>
<p><strong><a href="#242" title="2012-01-13 17:03:03">Ebow</a>:</strong> Your a life saver</p>

    		</section>
    		<footer class="post-footer">
    			<div itemscope itemprop="author" itemtype="http://schema.org/Person" class="post-author">
	                	<img itemprop="image" src="http://www.gravatar.com/avatar/F0AF2953911805542C66FD43B2F8FC38?s=155" alt="Mixu" class="post-author-avatar">
					<div class="post-author-info">
		              	<span itemprop="name">Mixu</span>
		              	<p itemprop="description" class="post-author-bio">Node.js developer</p>
	              	</div>
    			</div>
    		</footer>
		</article>
		
		<section itemprop="comment" class="post-comments">
			<div id="disqus_thread"></div>
			<script type="text/javascript">            
				var disqus_shortname = 'example';
		
			    (function() {
			        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			    })();
			</script>
			<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		</section>	</section>

	<footer class="footer" role="contentinfo">
		<div class="social-links-line"></div>
		<section class="social-links">
	        <div class="social-links-inner">
	        	<a class="icon icon-feed" href="http://localhost:5000/rss/" target="_blank">
	        		<i class="fa fa-rss"></i>
	        	</a>
	        	
	        	<a class="icon icon-twitter" href="http://twitter.com/" target="_blank">				
	        		<i class="fa fa-twitter"></i>
	        	</a>
	        	
	        	<a class="icon icon-facebook" href="http://facebook.com/" target="_blank">
	        		<i class="fa fa-facebook"></i>
	        	</a>
	        	
	        	<a class="icon icon-google-plus" href="http://plus.google.com/" target="_blank">
	        		<i class="fa fa-google-plus"></i>
	        	</a>
	        	
	        	<a class="icon icon-dribbble" href="http://dribbble.com/" target="_blank">
	        		<i class="fa fa-dribbble"></i>
	        	</a>
	        	
	        	<a class="icon icon-flickr" href="http://flickr.com/" target="_blank">
	        		<i class="fa fa-flickr"></i>
	        	</a>
	        	
	        	<a class="icon icon-foursquare" href="http://foursquare.com/" target="_blank">
	        		<i class="fa fa-foursquare"></i>
	        	</a>
	        	
	        	<a class="icon icon-instagram" href="http://instagram.com/" target="_blank">
	        		<i class="fa fa-instagram"></i>
	        	</a>
	        	
	        	<a class="icon icon-github" href="http://github.com/" target="_blank">
	        		<i class="fa fa-github"></i>
	        	</a>
	        	
	        	<a class="icon icon-tumblr" href="http://tumblr.com/" target="_blank">
	        		<i class="fa fa-tumblr"></i>
	        	</a>
	        	
	        	<a class="icon icon-pinterest" href="http://pinterest.com/" target="_blank">
	        		<i class="fa fa-pinterest"></i>
	        	</a>
	        	
	        	<a class="icon icon-linkedin" href="http://linkedin.com/" target="_blank">
	        		<i class="fa fa-linkedin"></i>
	        	</a>
	        	
	        	<a class="icon icon-vk" href="http://vk.com/" target="_blank">
	        		<i class="fa fa-vk"></i>
	        	</a>        </div>               
	    </section>
	</footer></main>

	<script src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/main.min.js"></script>
</body>
</html>