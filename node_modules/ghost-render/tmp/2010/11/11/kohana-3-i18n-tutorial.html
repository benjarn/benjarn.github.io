<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Kohana 3 i18n tutorial</title>	

	<meta name="description" content="">
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Kohana 3 i18n tutorial">
    <meta name="twitter:description" content="">
    <meta name="twitter:site" content="@username">
	<meta name="twitter:creator" content="@username">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Kohana 3 i18n tutorial">
    <meta property="og:description" content="">

    <link rel="stylesheet" href="/assets/css/style.css">

    <meta name="generator" content="Ghost ?" />
<link rel="alternate" type="application/rss+xml" title="Mixu&#39;s blog" href="/rss/">
<link rel="canonical" href="http://localhost:5000//2010/11/11/kohana-3-i18n-tutorial.md" />	
</head>
<body class="post-template">
	
<main id="container" role="main">
	<header class="header" role="banner" style="background-image: url(/assets/img/header.jpg);">
		<h1 class="blog-title">
			<a href="http://localhost:5000">Mixu&#x27;s blog</a>
		</h1>
		<div class="blog-description">A blog</div>
	</header>
	<nav class="menu" role="navigation">
		<a href="#">Home</a>
		<span class="delimiter">&#8226;</span>
		<a href="#">About</a>
		<span class="delimiter">&#8226;</span>
		<a href="#">Contacts</a>
	</nav>
	<section class="post-full">
		<article itemscope itemtype="http://schema.org/BlogPosting" role="article" class="post">
			<header class="post-header">        		
    			<h2 itemprop="name headline" class="post-title">
    				<a href="/2010/11/11/kohana-3-i18n-tutorial.html" itemprop="url">Kohana 3 i18n tutorial</a>
    			</h2>
    			<div class="post-meta">
        			<time datetime="2010-11-11" itemprop="datePublished">November 11, 2010</time>
        		</div>
        		<hr>
    		</header>
    		<section itemprop="articleBody" class="post-content">
    			<p>Continuing my series on Kohana 3 (see <a href="http://blog.mixu.net/2010/09/14/kohana-3-auth-sample-implementation-and-documentation/">Auth here</a> and <a href="http://blog.mixu.net/2010/10/30/how-to-use-kohana-3-validation-with-forms/">Validation here</a>), I&#39;m tackling Kohana 3 internationalization in this post.</p>
<p><h2>How Kohana 3 I18n works</h2>
Kohana 3&#39;s i18n functionality is implemented in two files:</p>
<p><ul>
    <li>/system/classes/i18n.php - Implements the i18n class, which provides all the functionality.</li>
    <li>/system/base.php - Implements the __() function, which is most commonly used for translating strings.</li>
</ul>
The <a href="http://kohanaframework.org/guide/api/I18n">Kohana_I18n class</a> provides the following functions:</p>
<p><ul>
    <li><strong>I18n::lang($lang = NULL)</strong>. Gets or sets the target language for translation. Call without parameters to get the current target language to which strings will be translated to.</li>
    <li><strong>I18n::get($string, $lang = NULL)</strong>. Returns the translation of the source string, optionally specifying what the target language should be. You should not usually use this function, however it has some uses (discussed later).</li>
    <li><strong>I18n::load($lang)</strong>. Loads the translation table for a given language, caches it and returns it.</li>
</ul>
The base file provides one translation function, the double underscore:</p>
<p><ul>
    <li><strong><strong>($string, $values, $lang = &#39;en-us&#39;)</strong>. When the current target language is the same as the param $lang, returns the same string. When the current target language is something else, returns the translated string if it exists, or the same string if it does not.The $values array determines replacements made in the string.</li>
</ul>
</strong>() is the main function you should be using. Just wrap all your strings into it.</p>
<p><strong>Storing and loading the translation strings</strong></p>
<p>As you notice if you look at the source, there are no translation strings here. They are stored under /application/i18n/<em>languagename</em>.php, where <em>languagename</em> is the name of the language you want to use. Kohana uses the string &quot;en-us&quot; as the default target language.</p>
<p>Note how the default language string has two parts: one specifying the language (en for English) and another for the region (us for the US).</p>
<p>Loading is done automatically on-demand when you call __(). The loading function I18n::load() works in a way that it can flexibly search for a file. It explodes the string on the &quot;-&quot; character, so the default target language &quot;en-us&quot; results in a search for the following files:</p>
<p><ul>
    <li>/application/i18n/en.php</li>
    <li>/application/i18n/en/us.php</li>
</ul>
Note that the order means that you can have a single language file for English, and then override some parts of the file - for example with the target language string &quot;en-gb&quot;, Kohana would first load the en.php file and then the /en/gb.php file; this makes it easy to have regional variants for strings (&quot;color&quot; vs. &quot;colour&quot;).</p>
<p><h2>What should I store in the i18n language files?</h2>
This is an important question, and Kohana does not make it for you. There are basically two approaches:</p>
<p><strong>Option 1: Storing identifiers</strong></p>
<pre class="hljs"><code>// <span class="hljs-flow">in</span> View
<span class="hljs-keyword">echo</span> __(&#39;about.description&#39;);
// <span class="hljs-flow">in</span> /i18n/latin.php
return array(
    &#39;about.description&#39; =&amp;gt; &#39;Lo<span class="hljs-comment">rem ipsum dolor amet...&#39;,</span>
);</code></pre><p><strong>Option 2: Storing the translated string itself</strong></p>
<pre class="hljs"><code>// <span class="hljs-flow">in</span> View
<span class="hljs-keyword">echo</span> __(&#39;This is a sample text...&#39;);
// <span class="hljs-flow">in</span> /i18n/latin.php
return array(
    &#39;This is a sample text...&#39; =&amp;gt; &#39;Lo<span class="hljs-comment">rem ipsum dolor amet...&#39;,</span>
);</code></pre><p>Which one is better? This is a matter of preference, and I strongly advise that you store the translated string itself. I absolutely <strong>HATE </strong>storing identifiers, having done that and worked with some applications that store identifiers. <a href="http://github.com/shadowhand">shadowhand </a>(Kohana&#39;s benevolent dictator) agrees, see <a href="http://forum.kohanaframework.org/discussion/comment/41757/">this discussion</a> and <a href="http://forum.kohanaframework.org/discussion/comment/24814/">this discussion</a>.</p>
<p>The problem with identifiers is that they make you remember a million different strings and hunt around for the right string to change in your file. Your translators have to remember what &quot;about.description&quot; meant when they translate your files, and you have to remember what is behind &quot;about.description&quot; when you make code changes. This is a maintenance nightmare, and if you forget to translate a string, the user will see a cryptic identifier.</p>
<p>The pros of identifiers are that the translation files are slightly smaller and use slightly less memory, and that you can change the translation files without changing the code. However, these are in my opionion rather meager advantages compared to the maintenance problems that are created.</p>
<p>Storing the string itself is better, because it allows you to see the text in your files and allows you to edit the translation in-place. This 1) allows for direct editing, and 2) makes it obvious that a new translation is needed since the English text is shown, and 3) if you forget to translate a string, the user will see something in English rather than just a identifier.</p>
<p>The nice thing is that if you write your application in the default target language, no I18n calls are performed when you use <strong>()! So you don&#39;t even pay the cost of a lookup. You do not need to create a translation file for the default language, because strings in the default language will be returned as-is by </strong>().</p>
<p>TL;DR: Store the translated string itself.</p>
<p><h2 style="font-size: 1.5em;">How do I tell Kohana I want to translate a string?</h2>
Use <strong>(&#39;This is my string&#39;). If the string is in a language other than en-us, then use </strong>(&#39;String&#39;, null, &#39;language&#39;); you will then need to have a /application/i18n/en.php file for the English equivalent.</p>
<p>If you need to replace items in the string, do something like:</p>
<pre class="hljs"><code>echo __(<span class="hljs-string">&#39;Dear :firstname, your username is: :user&#39;</span>, <span class="hljs-built_in">array</span>(
      <span class="hljs-string">&#39;:firstname&#39;</span> <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; <span class="hljs-variable">$user</span><span class="hljs-subst">-&amp;</span><span class="hljs-literal">gt</span>;name,
      <span class="hljs-string">&#39;:user&#39;</span> <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; <span class="hljs-variable">$user</span><span class="hljs-subst">-&amp;</span><span class="hljs-literal">gt</span>;username,
      ));<span class="hljs-subst">&lt;</span>/pre<span class="hljs-subst">&gt;</span></code></pre><p><h2>How do I start collecting the i18n strings?</h2>
Put a file like this as /application/languagename.php:</p>
<pre class="hljs"><code>&amp;lt;?<span class="hljs-function">php <span class="hljs-title">defined</span><span class="hljs-params">(<span class="hljs-string">&#39;SYSPATH&#39;</span>)</span> or <span class="hljs-title">die</span><span class="hljs-params">(<span class="hljs-string">&#39;No direct script access.&#39;</span>)</span></span>;

<span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-title">array</span><span class="hljs-params">(
    <span class="hljs-string">&#39;Hello World&#39;</span> =&amp;gt; <span class="hljs-string">&#39;Terve maailma&#39;</span>,
)</span></span>;</code></pre><p>and start writing the English-to-your-language strings.</p>
<p><strong>Now that you know how to do that - don&#39;t do it manually!</strong> Instead <a href="http://blog.mixu.net/2010/06/02/kohana3-automatically-collect-internationalization-strings/">take a look at my automatic I18n string collector</a>, which extends I18n and automatically detects missing translations (for whatever language is currently set as the target), and keeps updating your translation files. It saves some serious amounts of time.</p>
<p><h2>How do I allow the user to switch the language dynamically?</h2>
Use a cookie to store the user language, then load the value in /application/bootstrap.php:</p>
<pre class="hljs"><code><span class="hljs-comment">// default value for the cookie is &#39;fi&#39; for Finnish</span>
<span class="hljs-variable">$lang</span> <span class="hljs-subst">=</span> Cookie<span class="hljs-tag">::get</span>(<span class="hljs-string">&#39;lang&#39;</span>, <span class="hljs-string">&#39;fi&#39;</span>);
<span class="hljs-keyword">if</span>(<span class="hljs-subst">!</span>in_array(<span class="hljs-variable">$lang</span>, <span class="hljs-built_in">array</span>(<span class="hljs-string">&#39;fi&#39;</span>, <span class="hljs-string">&#39;sv&#39;</span>, <span class="hljs-string">&#39;en-us&#39;</span>))) {
   <span class="hljs-comment">// check the allowed languages, and force the default</span>
   <span class="hljs-variable">$lang</span> <span class="hljs-subst">=</span> <span class="hljs-string">&#39;fi&#39;</span>;
}
<span class="hljs-comment">// set the target language</span>
i18n<span class="hljs-tag">::lang</span>(<span class="hljs-variable">$lang</span>);</code></pre><p>Then provide some sort of interface to changing the cookie in a Controller:</p>
<pre class="hljs"><code>function action_change_language(<span class="hljs-variable">$lang</span>) {
   <span class="hljs-keyword">if</span>(<span class="hljs-subst">!</span>in_array(<span class="hljs-variable">$lang</span>, <span class="hljs-built_in">array</span>(<span class="hljs-string">&#39;fi&#39;</span>, <span class="hljs-string">&#39;sv&#39;</span>, <span class="hljs-string">&#39;en-us&#39;</span>))) {
      <span class="hljs-variable">$lang</span> <span class="hljs-subst">=</span> <span class="hljs-string">&#39;fi&#39;</span>;
   }
   Cookie<span class="hljs-tag">::set</span>(<span class="hljs-string">&#39;lang&#39;</span>, <span class="hljs-variable">$lang</span>);
   I18n<span class="hljs-tag">::lang</span>(<span class="hljs-variable">$lang</span>);
   Request<span class="hljs-tag">::instance</span>()<span class="hljs-subst">-&amp;</span><span class="hljs-literal">gt</span>;redirect(<span class="hljs-string">&#39;page/index&#39;</span>);
}</code></pre><p>The link would look something like Html::anchor(&#39;/controller/change_language/fi&#39;, &#39;Finnish&#39;) to change the language.</p>
<h2 id="comments">Comments</h2>
<p><strong><a href="#259" title="2011-01-04 17:53:11">Alex</a>:</strong> I think storing phrases in original language as a key isn&#39;t the best practice because it turns changing it into a pain in the ass: it&#39;s a key, so it should be changed in all translations. So, it&#39;s not just about changing source to change translation: it&#39;s about changing code and all other locales.</p>
<p><strong><a href="#260" title="2011-01-04 18:12:04">Mikito Takada</a>:</strong> I guess it depends on what kind of pain you want.</p>
<p>Since I usually write the original language version and someone else maintains the translation, I prefer that changing the string directly where it is used in the code.</p>
<p>This is easier for code maintenance and a bit harder for translation file maintenance, but translation time is cheaper than coding time.</p>
<p>I think it is good that changing the original language string forces you to also add a new translation for that text in all other languages. If the string such as a help message is changed, then it is different and should have a different translation as well.</p>
<p><strong><a href="#261" title="2011-01-04 18:55:18">Alex</a>:</strong> It makes developer thinking twice about any phrase being written. It&#39;s not possible to type just about.description or so and forward the text work to copyrighter or whoever writing texts and whose time (as you correctly mentioned) is cheaper.
So usage of this approach, I think, is very limited. I mean much more limited than storing partially-faceless identifiers.</p>
<p>Just imagine that native language is not English. That original translation could say even less that [usually] English-speaking identifiers that [usually] stores the essential meaning, short but clear. Then, is it a problem to return a string from default translation which is [usually] complete? Yeah, the case it&#39;s incomplete brings us to the prime argument of &#39;identifiers vs complete strings&#39; discussion.</p>
<p>I sincerely tried to deploy the approach in a quite a large project and I failed. The only &#39;bonus&#39; that stayed unbeaten is that English version comes &#39;for free&#39; â€” I mean either resourses for translation during request processing and (possibly) translation by the project&#39;s author.</p>
<p>But I believe it meets more cons than pros for those developers who speak languages widespread much less than English but still have an intension to make a slightly internationalized website (not internationalized, just translated actually).</p>
<p>So I came to the point than for described kind of tasks using that loathsome identifiers is an appropriate price.</p>
<p><strong><a href="#262" title="2011-07-08 20:27:05">Logan</a>:</strong> I&#39;d say overall it&#39;s gonna be a pain either way, so you need to decide which method will be best for the project.</p>
<p>Both methods seem to have clear advantages and disadvantages, but the context in which you use either method should be considered. Perhaps if the original phrases can come from a variety of languages it makes more sense to go they key -&gt; value route, but if you are getting a handoff of templates that are already in english with the copy already there, it makes sense to just wrap them in translation functions instead of moving all the copy out into a language file - probably makes sense to be aware of how either method can be useful</p>
<p><strong><a href="#264" title="2011-11-10 15:26:56">Artjom Kurapov</a>:</strong> I would argue for using identifiers. Although using direct text may look nice and easy, don&#39;t forget that if you can easily have two different meanings for single word and even more different meanings in other languages with different context. So using same text is not an option and you need identifiers to differentiate different meanings. And let&#39;s face it, if you do make a multilingual system, then that means that its already big and complex enough.</p>
<p>Sure, developers are always rushing to add new translation with as less thinking as possible, but identifiers should be long and well structured for everyone to understand where on site it is used</p>
<p><strong><a href="#265" title="2011-11-17 18:39:01">gps</a>:</strong> Greate tutorial!
I&#39;m follow your instructions to transform my website to a multi-language website, but I dont know to to make a default language that use <a href="http://mydomain.com">http://mydomain.com</a>, and another will use <a href="http://mydomain.com/{lang-code}">http://mydomain.com/{lang-code}</a>
Thanks for reading and please help!</p>

    		</section>
    		<footer class="post-footer">
    			<div itemscope itemprop="author" itemtype="http://schema.org/Person" class="post-author">
	                	<img itemprop="image" src="http://www.gravatar.com/avatar/F0AF2953911805542C66FD43B2F8FC38?s=155" alt="Mixu" class="post-author-avatar">
					<div class="post-author-info">
		              	<span itemprop="name">Mixu</span>
		              	<p itemprop="description" class="post-author-bio">Node.js developer</p>
	              	</div>
    			</div>
    		</footer>
		</article>
		
		<section itemprop="comment" class="post-comments">
			<div id="disqus_thread"></div>
			<script type="text/javascript">            
				var disqus_shortname = 'example';
		
			    (function() {
			        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			    })();
			</script>
			<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		</section>	</section>

	<footer class="footer" role="contentinfo">
		<div class="social-links-line"></div>
		<section class="social-links">
	        <div class="social-links-inner">
	        	<a class="icon icon-feed" href="http://localhost:5000/rss/" target="_blank">
	        		<i class="fa fa-rss"></i>
	        	</a>
	        	
	        	<a class="icon icon-twitter" href="http://twitter.com/" target="_blank">				
	        		<i class="fa fa-twitter"></i>
	        	</a>
	        	
	        	<a class="icon icon-facebook" href="http://facebook.com/" target="_blank">
	        		<i class="fa fa-facebook"></i>
	        	</a>
	        	
	        	<a class="icon icon-google-plus" href="http://plus.google.com/" target="_blank">
	        		<i class="fa fa-google-plus"></i>
	        	</a>
	        	
	        	<a class="icon icon-dribbble" href="http://dribbble.com/" target="_blank">
	        		<i class="fa fa-dribbble"></i>
	        	</a>
	        	
	        	<a class="icon icon-flickr" href="http://flickr.com/" target="_blank">
	        		<i class="fa fa-flickr"></i>
	        	</a>
	        	
	        	<a class="icon icon-foursquare" href="http://foursquare.com/" target="_blank">
	        		<i class="fa fa-foursquare"></i>
	        	</a>
	        	
	        	<a class="icon icon-instagram" href="http://instagram.com/" target="_blank">
	        		<i class="fa fa-instagram"></i>
	        	</a>
	        	
	        	<a class="icon icon-github" href="http://github.com/" target="_blank">
	        		<i class="fa fa-github"></i>
	        	</a>
	        	
	        	<a class="icon icon-tumblr" href="http://tumblr.com/" target="_blank">
	        		<i class="fa fa-tumblr"></i>
	        	</a>
	        	
	        	<a class="icon icon-pinterest" href="http://pinterest.com/" target="_blank">
	        		<i class="fa fa-pinterest"></i>
	        	</a>
	        	
	        	<a class="icon icon-linkedin" href="http://linkedin.com/" target="_blank">
	        		<i class="fa fa-linkedin"></i>
	        	</a>
	        	
	        	<a class="icon icon-vk" href="http://vk.com/" target="_blank">
	        		<i class="fa fa-vk"></i>
	        	</a>        </div>               
	    </section>
	</footer></main>

	<script src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/main.min.js"></script>
</body>
</html>