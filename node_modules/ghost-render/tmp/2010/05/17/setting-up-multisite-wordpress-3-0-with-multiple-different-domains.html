<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Setting up multisite Wordpress 3.0 with multiple different domains</title>	

	<meta name="description" content="">
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Setting up multisite Wordpress 3.0 with multiple different domains">
    <meta name="twitter:description" content="">
    <meta name="twitter:site" content="@username">
	<meta name="twitter:creator" content="@username">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Setting up multisite Wordpress 3.0 with multiple different domains">
    <meta property="og:description" content="">

    <link rel="stylesheet" href="/assets/css/style.css">

    <meta name="generator" content="Ghost ?" />
<link rel="alternate" type="application/rss+xml" title="Mixu&#39;s blog" href="/rss/">
<link rel="canonical" href="http://localhost:5000//2010/05/17/setting-up-multisite-wordpress-3-0-with-multiple-different-domains.md" />	
</head>
<body class="post-template">
	
<main id="container" role="main">
	<header class="header" role="banner" style="background-image: url(/assets/img/header.jpg);">
		<h1 class="blog-title">
			<a href="http://localhost:5000">Mixu&#x27;s blog</a>
		</h1>
		<div class="blog-description">A blog</div>
	</header>
	<nav class="menu" role="navigation">
		<a href="#">Home</a>
		<span class="delimiter">&#8226;</span>
		<a href="#">About</a>
		<span class="delimiter">&#8226;</span>
		<a href="#">Contacts</a>
	</nav>
	<section class="post-full">
		<article itemscope itemtype="http://schema.org/BlogPosting" role="article" class="post">
			<header class="post-header">        		
    			<h2 itemprop="name headline" class="post-title">
    				<a href="/2010/05/17/setting-up-multisite-wordpress-3-0-with-multiple-different-domains.html" itemprop="url">Setting up multisite Wordpress 3.0 with multiple different domains</a>
    			</h2>
    			<div class="post-meta">
        			<time datetime="2010-05-17" itemprop="datePublished">May 17, 2010</time>
        		</div>
        		<hr>
    		</header>
    		<section itemprop="articleBody" class="post-content">
    			<p>Wordpress 3.0 is coming out very soon (apparently they missed their original deadline, see <a href="http://wpdevel.wordpress.com/version-3-0-project-schedule/">the schedule here</a>) - and it has one killer feature for anyone who maintains multiple Wordpress sites: <strong>official support for multiple subdomains</strong> and (<em>unofficial</em>) support for multiple different domains. This means that one only has to maintain and upgrade one Wordpress installation.</p>
<p>Here is my guide to setting up Wordpress 3.0 with multiple different domains and subdomains - based on the experience I got from moving my own blogs to WP 3.0 beta 2 (still waiting for the final release before moving clients as well).</p>
<p><h2>Installing Wordpress 3.0</h2>
The basic installation process is the same as that of WP 2.9. Download, unzip, set up the database and the set up wp-config.php. If you aren&#39;t going to use the multi-site support, then not much will change. Brief instructions below.</p>
<p><h2>Multi-site mode with Apache</h2>
You will need to separately enable the multi-site mode, as well as take care of your Apache settings. WP 3.0 will handle all the requests it gets from a single directory, which means that all your subdomains must use that directory as their DocumentRoot/VirtualDocumentRoot.</p>
<p>Furthermore, WP 3.0 will assume that if you are using multi-site mode with subdomains, you want the subdomains under the first site&#39;s URL - ex. if your first WP 3.0 install is under www.domain.com, then WP 3.0 will set up subdomains in the format subdomain1.www.domain.com.</p>
<p>That means that if you want to use first-level subdomains (ex. blog.domain.com, subdomain2.domain.com etc.), you have to set up WP 3.0 so that your first blog is using the bare domain (ex. domain.com) and not on the www.domain.com subdomain.</p>
<p><h3>0. (Optional) Bare domain setup for Apache</h3>
The way in which you setup your bare domain (and forward from the www -subdomain to the bare domain) depends a lot on how you have set up your domain originally in Apache.</p>
<p>I have been using virtual hosts to host multiple sites, with each subdomain having its own directory. This means that I had to add an additional Vhost directive before my original Vhost directive in httpd.conf. Here is how I did it:</p>
<p><pre lang="apache">    ServerName domain.com
    ServerAlias domain.com blog.domain.com subdomain1.domain.com
    DocumentRoot /var/www/domain.com/www</pre>
As you can see in the first Vhosts directive, I have used the ServerAlias directive to specify domain.com, blog.domain.com and subdomain1.domain.com to be served from the DocumentRoot /var/www/domain.com/www (which is where I have installed WP 3.0).</p>
<p>In addition, I still have the rest of my subdomains served from a VirtualDocumentRoot, and have a forward from the www.domain.com -subdomain to the domain.com bare domain.</p>
<p><pre lang="apache">    ServerName domain.com
    ServerAlias *.domain.com
    VirtualDocumentRoot /var/www/domain.com/%1</p>
<pre class="hljs"><code><span class="hljs-comment"># rewrite www to bare domain</span>
<span class="hljs-keyword"><span class="hljs-common">RewriteEngine</span></span> <span class="hljs-literal">On</span>
<span class="hljs-keyword"><span class="hljs-common">RewriteCond</span></span> <span class="hljs-cbracket">%{HTTP_HOST}</span> ^www.domain.com$<span class="hljs-sqbracket"> [NC]</span>
<span class="hljs-keyword"><span class="hljs-common">RewriteRule</span></span> (.*) <a href="http://domain.com">http://domain.com</a><span class="hljs-number">$1</span><span class="hljs-sqbracket"> [R=301,L]&lt;/pre&gt;</span></code></pre><p>Apache will use the first matching VirtualHost directive (see &quot;<a href="http://httpd.apache.org/docs/2.2/vhosts/details.html">An in-depth discussion of Virtual Host Matching</a>&quot; for more details).</p>
<p>If you want to test your setup - remember to restart Apache - you can use an online redirect checker such as: <a href="http://www.internetofficer.com/seo-tool/redirect-check/">http://www.internetofficer.com/seo-tool/redirect-check/</a></p>
<p><h3>1. Get the files and unzip them</h3></p>
<p><h3>2. Edit wp_config_sample.php</h3>
You can use <a href="https://api.wordpress.org/secret-key/1.1/salt/">https://api.wordpress.org/secret-key/1.1/salt/</a> to generate the secret keys</p>
<p><h3>3. Enable multisite</h3>
Add:</p>
<p><pre lang="php"> define(’WP_ALLOW_MULTISITE’, true);</pre>
to wp-config.php after the secret keys</p>
<p><h3>4. Log in, go to Tools/Network</h3>
Select either the blogs-as-subdomains or blogs-as-directories option and install.</p>
<p><h3>5. Make the changes detailed on the post-install page</h3>
WP 3.0 gives you a number of changes you will need to make manually to .htaccess and wp-config.php.</p>
<p><h2>Adding a new subdomain</h2>
You have now set up the multisite functionality. Next, add a subdomain (see below for how to add a different domain).</p>
<p><h3>1. Login in on your main site</h3></p>
<p><h3>2. Go to Super Admin (new menu at the top)</h3></p>
<p><h3>3. Use the add site form to add a new subdomain</h3></p>
<p><h3>4. Configure your DNS and add a Vhost for the subdomain</h3>
Make sure there is a DNS entry for your subdomain - if you don&#39;t have a wildcard redirect for your domain to your server. If you did the Apache configuration, all you need to do now is to set up your DNS so that the subdomains you want are mapped to your server.</p>
<p><strong>Quick tip for Windows</strong>: edit C:WindowsSystem32driversetchosts and add a temporary hosts entry for your new subdomain, such as:</p>
<pre class="hljs"><code><span class="hljs-number">123.14</span>.<span class="hljs-number">15.16</span> subdomain.domain.<span class="hljs-keyword">com</span></code></pre><p>This will allow you to test the subdomain without having to wait for DNS to propagate. Under Win7, you need to start Notepad as an Administrator (right-click) to edit the file.</p>
<p><h3>5. All done!</h3>
Try navigating to your new subdomain. It should be set up now!</p>
<p><h2>Adding a new (different) domain</h2></p>
<p><h3>1. Use the add site form to add a new subdomain</h3>
You will use the default tools to create all the tables, then you will make a small number of changes to make Wordpress accept a different domain. All credit for this method goes <a href="http://www.interconnectit.com/840/wordpress-3-0-multisite-with-multiple-domains-setup/">InterconnectIt - see their writeup here</a>.</p>
<p><h3>2. Configure your DNS and add a Vhost for the subdomain</h3>
The easiest way is to add another ServerAlias domain to the original domain&#39;s VirtualHost -&gt; ServerAlias directive.</p>
<p>If you try to access the site now, you will get a &quot;Registration&quot; page. This means the Vhost is working.</p>
<p><h3>3. Edit the wp_site table to include your new domain</h3>
This table stores all the domains that can be used in WP 3.0.</p>
<p>Leave &quot;id&quot; empty (it is an autoincrement field), set &quot;domain&quot; to the domain name, &quot;path&quot; should be /.</p>
<p>Make a note of the id your newly inserted row gets after saving, since you will need it in the next step.</p>
<p><h3>4. Edit the wp_blogs table to use the new domain</h3>
Find the row for the subdomain you added earlier. Change &quot;site_id&quot; to the id given to the new row in the wp_site table. Change &quot;domain&quot; to the domain name you want to use.</p>
<p><h3>5. Edit wp<em>[blog_id]_options to use the new domain name</h3>
The WP 3.0 multisite database schema is sharded by having the blog id in the table names. By default these are in the form wp</em>[blog<em>id]</em>*, so you will need to find which set of tables contains your new blog.</p>
<p>Each Wordpress blog stores a small number of settings which need be changed to use the new domain name. You can use the query below to find the mentions of the domain in the options table:</p>
<pre class="hljs"><code><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-string"><code>wp_[blog_id]_options</code></span> <span class="hljs-keyword">WHERE</span> <span class="hljs-string"><code>option_value</code></span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&quot;%subdomain.domain.com%&quot;</span>;</span></code></pre><p>For me these are: siteurl, home, fileupload_url. Change them to use the new domain.</p>
<p><h3>6. Done!</h3>
<strong>Do you need to move an existing WP 2.9 to WP3.0 multisite?</strong> If you are moving an existing site to the WP multisite you&#39;ve set up, <a href="http://blog.mixu.net/2010/05/23/upgrading-moving-wordpress-2-9-installs-to-multisite-wp-3-0/">check out my second tutorial on the topic</a>.</p>
<p><strong>Did you run into problems enabling themes or plugins on your separate domains?</strong> Have a look at <a href="http://blog.mixu.net/2010/05/31/wordpress-3-0-multi-site-multi-domain-problems-with-solutions/">how I solved a number of issues related to the separate domains setup</a>.</p>
<p><h2>References</h2></p>
<ol>
    <li><a href="http://www.interconnectit.com/840/wordpress-3-0-multisite-with-multiple-domains-setup/">http://www.interconnectit.com/840/wordpress-3-0-multisite-with-multiple-domains-setup/</a></li>
</ol>

<h2 id="comments">Comments</h2>
<p><strong><a href="#180" title="2010-05-23 15:54:57">Jeff</a>:</strong> Hi,</p>
<p>I&#39;ve followed all these steps, and successfully setup a completely separate domain (like www.johnny.com) to display a second blog setup in WP 3 (originally setup using subdomains, like johnny.mysite.com).</p>
<p>After this success however, my super admin cannot see the new site in Super Admin&gt;Sites, nor can I login when going to the new wp-admin section (like www.johnny.com/wp-admin) using this super admin.</p>
<p>Have you found this to be the case as well?</p>
<p><strong><a href="#181" title="2010-05-23 16:18:53">Mikito Takada</a>:</strong> Yes, after using a separate domain the site is no longer listed my Super Admin-&gt;Sites section. I expect that the interface will be improved in future releases of Wordpress 3.</p>
<p>However, I have been able to use the Super admin login on the alternate domain&#39;s /wp-admin/ and administer it normally. Another slight problem with separate domains was that user registration links were not shown, but I&#39;m not sure whether that is an issue with the Twenty-Ten theme or with the core. If you can&#39;t use the alternate domain with the super admin login, have a look at what the wp_capabilities field in wp_users says.</p>
<p><strong><a href="#182" title="2010-05-23 16:56:57">Jeff</a>:</strong> Mikito,</p>
<p>Thanks for the tips, I just figured out that you can go in via Super Admin &gt; Sites, and change the domain name to whatever you want. As long as your DNS and Apache is configured correctly, you don&#39;t have to change any database tables. Super easy!</p>
<p>-Jeff</p>
<p><strong><a href="#183" title="2010-05-24 18:57:02">Mikito Takada</a>:</strong> It seems indeed that you can change the domain under Super Admin -&gt; Sites BUT it does not change the fileupload<em>url option in wp</em>[blog_id]_options.</p>
<p>And if you don&#39;t do the wp_site and wp_blogs table editing, it&#39;s not possible to log in as administrator - this is with the current nightly.</p>
<p>But this problem only appears if you are using separate domains.</p>
<p><strong><a href="#184" title="2010-06-13 19:20:48">Jon Henshaw</a>:</strong> This is what I&#39;ve been using: <a href="http://raventools.com/blog/2890/how-to-easily-manage-multiple-wordpress-sites-with-one-database-and-one-code-base" rel="nofollow">How to Easily Manage Multiple WordPress Sites With One Database and One Code Base</a>. One of our developers wrote it in 2008, and it&#39;s been working well for me ever since.</p>
<p>The problem is that everything isn&#39;t controlled in one admin, which is very annoying. Especially as I continue to add new sites. I&#39;m curious to know if you&#39;ve had any issues with this setup. I&#39;m also curious to know why WordPress hasn&#39;t implemented this, if it&#39;s technically possible, as you&#39;ve just demonstrated.</p>
<p><strong><a href="#186" title="2010-07-17 02:53:53">Daniel</a>:</strong> Here&#39;s a simple fix for sites not showing up under Super Admin-&gt;Sites when WP 3.0 is in separate domain mode.</p>
<p>Edit the file /wp-admin/ms-site.php, look for this query statement.</p>
<p>$query = &quot;SELECT * FROM {$wpdb-&gt;blogs} WHERE site_id = &#39;{$wpdb-&gt;siteid}&#39; &quot;;</p>
<p>Remove the WHERE clause. The new query should look like this.</p>
<p>$query = &quot;SELECT * FROM {$wpdb-&gt;blogs} &quot;;</p>
<p>Save it and give it try. I have 3 separate domain that I&#39;m testing with and so far this has worked.</p>
<p>Thanks for writing your issues down, it has saved hours of work.</p>
<p>-Daniel</p>
<p><strong><a href="#187" title="2010-07-17 10:28:19">Mikito Takada</a>:</strong> Daniel, thank you for that tip! Awesome!</p>
<p><strong><a href="#189" title="2010-07-25 16:14:32">dmartin</a>:</strong> That was absolutelly perfect, thank you so much for the tutorial... Maybe I would add the correct mysql commands for newbies (I&#39;m one of those, and it has taken a little time to guess the right syntax for the modifications), but everything runs perfectly well right now.</p>
<p>I&#39;ve set up a test system with two blogs, and after that last modification (didn&#39;t show the two blogs after all the process in the Sites menu) everything is perfect.</p>
<p>I&#39;m testing now the user registration, I&#39;d like to add a Facebook Connect option and &quot;build a community&quot; (with or without FB) which could be useful in case users want to know each other. I&#39;ve seen sites that do this, and I&#39;ll try to implement that on my blog network.</p>
<p>Great article, thank you so much!!</p>
<p><strong><a href="#190" title="2010-08-08 19:34:09">Ghufron</a>:</strong> I&#39;ve two difference domains, ghufron.com and postingan.com. Can I create multi-site with different domain? For example, I&#39;ve installed WP 3.0.1 on ghufron.com and I want to create multi-site on it with postingan.com</p>
<p>Please reply via email :)</p>
<p>Thank you</p>
<p><strong><a href="#191" title="2010-08-21 19:26:21">Žiga Dolhar</a>:</strong> Hey,</p>
<p>after following your instructions, I am able to log in to blogs on different domains. However, those blogs under different domains do not anymore show the &quot;plugin&quot; panel in administration. Also, linked to this, when I try to import contents into this new (on-a-different-domain) blog, the import plugin is not available (since it is a plugin).</p>
<p><strong><a href="#192" title="2010-08-25 17:02:25">DMartin</a>:</strong> Daniel,</p>
<p>I&#39;ve just repeated the process for an upgraded instalation of my blog network, and I&#39;ve seen that that WHERE clause is not anymore at wp-admin/ms-admin.php if you are working with Wordpress 3.0.1.</p>
<p>Instead, you should edit wp-admin/ms-sites.php</p>
<p>Everything is the same for the rest of the comment.</p>
<p>Thank you so much for your post!</p>
<p><strong><a href="#193" title="2010-09-14 09:11:01">Mikito Takada</a>:</strong> Ziga,</p>
<p>have a look at my post on fixing the problems with this setup, there should be solution: <a href="http://blog.mixu.net/2010/05/31/wordpress-3-0-multi-site-multi-domain-problems-with-solutions/">http://blog.mixu.net/2010/05/31/wordpress-3-0-multi-site-multi-domain-problems-with-solutions/</a></p>
<p><strong><a href="#194" title="2010-11-01 02:04:31">Daniel</a>:</strong> DMartin,
Great, I&#39;m about to give 3.0.1 a go, thanks for the heads up.</p>
<p>-Daniel</p>
<p><strong><a href="#195" title="2010-11-10 01:48:39">Daniel</a>:</strong> Has anyone had issues with 3.0.1 when editing sites? I&#39;m getting &quot;You do not have permission to access this page.&quot;</p>
<p>Editing worked on 3.0.0, now that I&#39;ve upgraded it&#39;s broken.</p>
<p>I&#39;ve found this line of code that may be the issue.</p>
<p>if($details-&gt;site<em>id != $wpdb-&gt;siteid)
         wp<em>die( </em></em>( &#39;You do not have permission to access this page.&#39; ) );</p>
<p>site_id is the new domain, where siteid is the &quot;root&quot; domain or the main domain.</p>
<p>Any ideas?</p>
<p><strong><a href="#196" title="2010-12-08 05:10:39">Dan S.</a>:</strong> Mikito,</p>
<p>Thanks for that post -- it solved most of the issues I&#39;ve encountered.</p>
<p>The one problem that I haven’t been able to solve is a file size upload limit of 1mb. It’s neither respectful of the PHP.ini file size limits, nor any set in .htaccess</p>
<p>Any suggestions?</p>
<p><strong><a href="#197" title="2011-01-19 06:32:18">configure domain</a>:</strong> This is an awesome resource.Thank you so much for putting it together in such a well organized and complete manner.I am going to use your site as a reference and hopefully learn more.I hope you publish more articles like this again shortly!</p>
<p><strong><a href="#198" title="2011-03-15 04:28:22">John</a>:</strong> Where is $query = “SELECT * FROM {$wpdb-&gt;blogs} WHERE site_id = ‘{$wpdb-&gt;siteid}’ “;</p>
<p>on WP 3.1?</p>
<p>Thanks</p>
<p><strong><a href="#199" title="2011-03-15 10:28:16">Mikito Takada</a>:</strong> ./wp-admin/ms-sites.php:16432:        $query = &quot;SELECT * FROM {$wpdb-&gt;blogs} WHERE site_id = &#39;{$wpdb-&gt;siteid}&#39; &quot;;</p>
<p><strong><a href="#200" title="2011-03-23 21:18:19">Vicente</a>:</strong> /wp-admin/includes/class-wp-ms-sites-list-table.php</p>
<p><strong><a href="#666" title="2013-03-18 17:20:25">chandanks87</a>:</strong> hi,
For each new domain I need to do like this. Is there any plugin which substitute these all manual job.</p>

    		</section>
    		<footer class="post-footer">
    			<div itemscope itemprop="author" itemtype="http://schema.org/Person" class="post-author">
	                	<img itemprop="image" src="http://www.gravatar.com/avatar/F0AF2953911805542C66FD43B2F8FC38?s=155" alt="Mixu" class="post-author-avatar">
					<div class="post-author-info">
		              	<span itemprop="name">Mixu</span>
		              	<p itemprop="description" class="post-author-bio">Node.js developer</p>
	              	</div>
    			</div>
    		</footer>
		</article>
		
		<section itemprop="comment" class="post-comments">
			<div id="disqus_thread"></div>
			<script type="text/javascript">            
				var disqus_shortname = 'example';
		
			    (function() {
			        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			    })();
			</script>
			<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		</section>	</section>

	<footer class="footer" role="contentinfo">
		<div class="social-links-line"></div>
		<section class="social-links">
	        <div class="social-links-inner">
	        	<a class="icon icon-feed" href="http://localhost:5000/rss/" target="_blank">
	        		<i class="fa fa-rss"></i>
	        	</a>
	        	
	        	<a class="icon icon-twitter" href="http://twitter.com/" target="_blank">				
	        		<i class="fa fa-twitter"></i>
	        	</a>
	        	
	        	<a class="icon icon-facebook" href="http://facebook.com/" target="_blank">
	        		<i class="fa fa-facebook"></i>
	        	</a>
	        	
	        	<a class="icon icon-google-plus" href="http://plus.google.com/" target="_blank">
	        		<i class="fa fa-google-plus"></i>
	        	</a>
	        	
	        	<a class="icon icon-dribbble" href="http://dribbble.com/" target="_blank">
	        		<i class="fa fa-dribbble"></i>
	        	</a>
	        	
	        	<a class="icon icon-flickr" href="http://flickr.com/" target="_blank">
	        		<i class="fa fa-flickr"></i>
	        	</a>
	        	
	        	<a class="icon icon-foursquare" href="http://foursquare.com/" target="_blank">
	        		<i class="fa fa-foursquare"></i>
	        	</a>
	        	
	        	<a class="icon icon-instagram" href="http://instagram.com/" target="_blank">
	        		<i class="fa fa-instagram"></i>
	        	</a>
	        	
	        	<a class="icon icon-github" href="http://github.com/" target="_blank">
	        		<i class="fa fa-github"></i>
	        	</a>
	        	
	        	<a class="icon icon-tumblr" href="http://tumblr.com/" target="_blank">
	        		<i class="fa fa-tumblr"></i>
	        	</a>
	        	
	        	<a class="icon icon-pinterest" href="http://pinterest.com/" target="_blank">
	        		<i class="fa fa-pinterest"></i>
	        	</a>
	        	
	        	<a class="icon icon-linkedin" href="http://linkedin.com/" target="_blank">
	        		<i class="fa fa-linkedin"></i>
	        	</a>
	        	
	        	<a class="icon icon-vk" href="http://vk.com/" target="_blank">
	        		<i class="fa fa-vk"></i>
	        	</a>        </div>               
	    </section>
	</footer></main>

	<script src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/main.min.js"></script>
</body>
</html>