<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Getting started with Useradmin, my Kohana 3 auth admin module</title>	

	<meta name="description" content="">
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Getting started with Useradmin, my Kohana 3 auth admin module">
    <meta name="twitter:description" content="">
    <meta name="twitter:site" content="@username">
	<meta name="twitter:creator" content="@username">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Getting started with Useradmin, my Kohana 3 auth admin module">
    <meta property="og:description" content="">

    <link rel="stylesheet" href="/assets/css/style.css">

    <meta name="generator" content="Ghost ?" />
<link rel="alternate" type="application/rss+xml" title="Mixu&#39;s blog" href="/rss/">
<link rel="canonical" href="http://localhost:5000//2011/01/13/getting-started-with-useradmin-my-kohana-3-auth-admin-module.md" />	
</head>
<body class="post-template">
	
<main id="container" role="main">
	<header class="header" role="banner" style="background-image: url(/assets/img/header.jpg);">
		<h1 class="blog-title">
			<a href="http://localhost:5000">Mixu&#x27;s blog</a>
		</h1>
		<div class="blog-description">A blog</div>
	</header>
	<nav class="menu" role="navigation">
		<a href="#">Home</a>
		<span class="delimiter">&#8226;</span>
		<a href="#">About</a>
		<span class="delimiter">&#8226;</span>
		<a href="#">Contacts</a>
	</nav>
	<section class="post-full">
		<article itemscope itemtype="http://schema.org/BlogPosting" role="article" class="post">
			<header class="post-header">        		
    			<h2 itemprop="name headline" class="post-title">
    				<a href="/2011/01/13/getting-started-with-useradmin-my-kohana-3-auth-admin-module.html" itemprop="url">Getting started with Useradmin, my Kohana 3 auth admin module</a>
    			</h2>
    			<div class="post-meta">
        			<time datetime="2011-01-13" itemprop="datePublished">January 13, 2011</time>
        		</div>
        		<hr>
    		</header>
    		<section itemprop="articleBody" class="post-content">
    			<p>In this post, I discuss the details of how to use my admin module. Hopefully this covers all the stuff you need to know; if not, let me know in the comments. I&#39;m just one guy, so it may be quicker to ask on the Kohana forums for troubleshooting. Previous writing:</p>
<p><ol>
    <li><a href="http://blog.mixu.net/2010/09/06/step-by-step-guide-to-kohana-3-auth/">Setting up the basic Auth in KO3</a> (part 1)</li>
    <li><a href="http://blog.mixu.net/2010/09/07/kohana-3-auth-the-auth-module-functionality/">An overview of the functionality provided by the Auth module</a> (part 2)</li>
    <li><a href="http://blog.mixu.net/2010/09/14/kohana-3-auth-sample-implementation-and-documentation/">Kohana 3 auth: sample implementation and documentation</a> (part 3)</li>
    <li>Getting started with Useradmin, my Kohana 3 auth admin module (part 4; this part)</li>
</ol></p>
<p><h3>KO3.1 support is DONE, updating this tutorial to match that now. See part 3 above for changelog.</h3></p>
<p><h3><span style="font-size: 20px;">1. Installation</span></h3>
<strong>Changes from 3.x version of the module to 3.1.x compatible version</strong></p>
<p>The useradmin module is no longer offered as a &quot;single application&quot; with Kohana bundled in the same repository. Instead, only the content of the /modules/user directory is now in the repository. This makes it easier to work with the repository in Github.</p>
<p><ul>
    <li>You should copy the module to your /modules -directory.</li>
    <li>You need to have the kohana-email module for sending forgotten password emails for now, if you want to use that feature.</li>
    <li>Kohana 3.1 no longer bundles the pagination module which is used in the admin interface. You have to<a href="https://github.com/kohana/pagination"> get that module </a>and enable it.</li>
</ul>
<strong>Database schema</strong></p>
<p>Import the MySQL schema from /schema.sql. It will create a &quot;useradmin&quot; database. You might want to rename that when you start; in that case you need to change /application/config/database.php.</p>
<p><span style="text-decoration: underline;"><em>Watch this space! </em></span>Right now, the database schema&#39;s passwords do not work out of the box. I&#39;m working on making a script to generate a secure starting SQL file for you... For now, use Auth::instance()-&gt;hash(&#39;password&#39;) and then reset the admin password via your MySQL admin tool.</p>
<p><strong>Module load order</strong></p>
<p>Make sure that Useradmin is loaded before Auth in your bootstrap.php, because otherwise Kohana will not load the correct Model_User (it&#39;ll use the one in Auth, not the one in Useradmin). Example with the minimum required modules:</p>
<pre class="hljs"><code>Kohana<span class="hljs-tag">::modules</span>(<span class="hljs-built_in">array</span>(
   <span class="hljs-string">&#39;user&#39;</span>       <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; MODPATH<span class="hljs-built_in">.<span class="hljs-variable">&#39;user&#39;</span></span>,       <span class="hljs-comment">// Useradmin module</span>
   <span class="hljs-string">&#39;auth&#39;</span>       <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; MODPATH<span class="hljs-built_in">.<span class="hljs-variable">&#39;auth&#39;</span></span>,       <span class="hljs-comment">// Basic authentication</span>
   <span class="hljs-string">&#39;database&#39;</span>   <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; MODPATH<span class="hljs-built_in">.<span class="hljs-variable">&#39;database&#39;</span></span>,   <span class="hljs-comment">// Database access</span>
   <span class="hljs-string">&#39;orm&#39;</span>        <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; MODPATH<span class="hljs-built_in">.<span class="hljs-variable">&#39;orm&#39;</span></span>,        <span class="hljs-comment">// Object Relationship Mapping</span>
   <span class="hljs-string">&#39;pagination&#39;</span>        <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; MODPATH<span class="hljs-built_in">.<span class="hljs-variable">&#39;pagination&#39;</span></span>,        <span class="hljs-comment">// Pagination</span>
   <span class="hljs-string">&#39;oauth&#39;</span>        <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; MODPATH<span class="hljs-built_in">.<span class="hljs-variable">&#39;oauth&#39;</span></span>,        <span class="hljs-comment">// Kohana-Oauth for Twitter</span>
   <span class="hljs-string">&#39;kohana-email&#39;</span>        <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; MODPATH<span class="hljs-built_in">.</span><span class="hljs-string">&#39;kohana-email&#39;</span>,        <span class="hljs-comment">// Kohana-Email for email</span>
   ));</code></pre><p>The required modules are user, auth, database, ORM, Pagination. Optional modules: Oauth (for Twitter) and kohana-email (for email sending support).</p>
<p><strong>Writable directories</strong></p>
<p>Make sure the /application/logs and /application/cache directories exist and are writable by your server (you&#39;ll get an error if they aren&#39;t).</p>
<p><strong>Copying the static files for performance </strong></p>
<p>The useradmin module now includes a simple media serving capability so that you can get started by just including the module.</p>
<p>However, since it is not a good idea for performance to load CSS and image files via Kohana, you should copy the /public folder to wherever you put your webroot. This way Apache will load it directly (since direct file accesses are preferred in the Kohana default htaccess file).</p>
<p><strong>KO3.1 Auth configuration</strong></p>
<p>In Kohana 3.1, the default hash method is now sha256 instead of sha1. This means that there is no salt_pattern; and that old KO 3.x passwords are not compatible with KO 3.1! See <a href="http://dev.kohanaframework.org/issues/3163">the discussion on this bug for more information</a>. TL;DR: the salt pattern is weak, so if someone steals your database but does not know your salt_key, they can deduce it easily and perform a dictionary attack.</p>
<p>Instead, you need to configure your hash_key which gets passed to <a href="http://php.net/manual/en/function.hash-hmac.php">http://php.net/manual/en/function.hash-hmac.php</a>. You can also use any of the hast_hmac() supported algorithms if you want to.</p>
<p>Use a random hash_key, for example from: <a href="https://www.grc.com/passwords.htm">https://www.grc.com/passwords.htm</a></p>
<p>return array</p>
<pre class="hljs"><code>(
    <span class="hljs-string">&#39;driver&#39;</span> <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; <span class="hljs-string">&#39;ORM&#39;</span>,
    <span class="hljs-string">&#39;hash_method&#39;</span> <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; <span class="hljs-string">&#39;sha256&#39;</span>,
    <span class="hljs-string">&#39;hash_key&#39;</span> <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; <span class="hljs-built_in">NULL</span>, <span class="hljs-comment">// replace with random string</span>
    <span class="hljs-string">&#39;lifetime&#39;</span> <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; <span class="hljs-number">1209600</span>,
    <span class="hljs-string">&#39;session_key&#39;</span> <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; <span class="hljs-string">&#39;auth_user&#39;</span>,
    <span class="hljs-string">&#39;users&#39;</span> <span class="hljs-subst">=&amp;</span><span class="hljs-literal">gt</span>; <span class="hljs-built_in">array</span>(),
);</code></pre><p><strong>Migrating from KO3.x</strong></p>
<p><span style="text-decoration: underline;"><em>Watch this space!</em></span> I&#39;m working on a better migration path than throwing out the old password database...</p>
<p>Important: Note that the password column should be CHAR(64) for sha256.</p>
<p><span style="font-size: 20px; font-weight: bold;">2. Useradmin configuration</span></p>
<p>By default, reCaptcha support and Facebook logins are disabled, but password reset via email is enabled.</p>
<p><strong>Facebook login</strong></p>
<p>To enable Facebook login, set the &quot;facebook&quot; option to true in config/useradmin.php. Then you need to copy /modules/user/config/facebook.php as /application/config/facebook.php and set app_id and secret to the values you got from Facebook. You need to <a href="http://developers.facebook.com/setup/">register your site/app here</a> to get those values. That&#39;s really all it takes; you can then start accepting Facebook logins.</p>
<p>For more info about how Facebook logins work, see my <a href="http://blog.mixu.net/2010/12/27/implementing-facebook-login-single-sign-on-part-1/">series on implementing Facebook login</a>. No additional database changes are needed if you are using my schema.sql; otherwise you need to add one extra field to your User table (<code>facebook_user_id</code> BIGINT( 20 )).</p>
<p><strong>ReCaptcha on registration</strong></p>
<p>To enable a ReCaptcha check on registration, set the &quot;captcha&quot; option to true in config/useradmin.php. Then you need to copy /modules/user/config/recaptcha.php as /application/config/recaptcha.php and set privatekey and publickey to the values you get from reCaptcha. <a href="https://www.google.com/recaptcha/admin/create">Register for reCaptcha here</a>.</p>
<p><strong>Disabling password reset via email, Facebook login or ReCaptcha on registration</strong></p>
<p>If you want to disable Facebook logins, or disable the password reset via email functionality, then copy /modules/user/config/useradmin.php to /application/config/ and set either &quot;facebook&quot; or &quot;email&quot; to  false. You can also change the address from which the password reset emails are sent in that file.</p>
<p><h2>3. Customization</h2>
<strong>Creating your own controllers which extend Controller_App</strong></p>
<p>All the controllers in Useradmin inherit from Controller_App in /modules/user/classes/controller/app.php.</p>
<p>You&#39;ll want you own controllers to also inherit from it, since Controller_App defines a before() action which performs the auth checks.</p>
<p>In addition, Controller_App provides support for template rendering: it defaults to using ﻿/modules/user/views/template/default.php. If you want to override that template, you&#39;ll want to copy the default.php file to /application/views/template/default.php and modify it.</p>
<p>The Controller classes for Useradmin default to using /modules/user/views/template/useradmin.php. This means that you can have one UI template for Useradmin, and another for the rest of your application.  Alternatively you can integrate the two by adding links to your own template.</p>
<p><strong>Naming your controllers</strong></p>
<h2 id="comments">Comments</h2>
<p><strong><a href="#303" title="2011-01-24 19:41:54">Sam</a>:</strong> Not sure why I&#39;m getting the following error when I try to use facebook login....</p>
<p>Kohana_Exception [ 0 ]: Invalid method generate_password called in Model_User</p>
<p>Any help would be greatly appreciated.  Thanks!</p>
<p><strong><a href="#304" title="2011-01-24 21:45:57">Mikito Takada</a>:</strong> My quick guess is: in bootstrap.php, are you loading the Useradmin module before the Auth module?</p>
<p>You need to load the Useradmin (a.k.a. User) module before Auth so that Kohana uses the Model_User in Useradmin which has generate_password, rather than the one from Auth, which doesn&#39;t.</p>
<p>Damnit! I forgot that from this page though it was discussed in the previous blog post comments. Page updated!</p>
<p>BTW, let me know if you get everything working (including Facebook) with this guide; I&#39;ve tested this myself but I may have glossed over some details since I wrote the module.</p>
<p><strong><a href="#305" title="2011-01-24 22:13:37">Sam</a>:</strong> Awesome!  That&#39;s exactly what it was.  I activated the useradmin module right after the auth module in the bootstrap file.  Thanks for your quick response!  It would of taken me hours to figure that out.  =)  Also, how do you disable the profile data?</p>
<p><strong><a href="#306" title="2011-01-25 02:33:57">Mikito Takada</a>:</strong> What do you mean by disabling the profile data? If you mean disabling the profile editing, you can do that by creating your own Controller_User in application/classes/controller/user.php (extends Controller_Useradmin_User) and overriding the action_profile_edit function with a simple redirect back to the profile page / to the change password action. The change password action (action_change_password) is there for applications that don&#39;t want to use user profiles but still want to have a page to change the password only.</p>
<p><strong><a href="#307" title="2011-01-25 03:56:41">Sam</a>:</strong> Sorry, I should of explained myself better.  I meant to say the profiling information on the bottom of the page for execution time, database queries, etc etc.  Thanks!</p>
<p><strong><a href="#308" title="2011-01-25 19:28:59">Mikito Takada</a>:</strong> To remove the profiling information, just remove the code that prints the profiler view from the template you are using (e.g. module/user/view/template/useradmin.php or template/default.php; you can copy them to your app/views/ directory to override them).</p>
<p><strong><a href="#309" title="2011-01-26 15:35:39">Sam</a>:</strong> Awesome, Thanks!</p>
<p><strong><a href="#310" title="2011-01-27 00:26:36">Davey</a>:</strong> Really awesome module!</p>
<p>Quick question, I want to achieve this:</p>
<p>website.com/backoffice/user/register</p>
<p>As you can see I want &#39;backoffice&#39; in front of the controller name, how can I achieve this?</p>
<p><strong><a href="#311" title="2011-01-27 23:24:36">Mikito Takada</a>:</strong> See: <a href="http://kohanaframework.org/guide/kohana/routing">http://kohanaframework.org/guide/kohana/routing</a> and <a href="http://kerkness.ca/wiki/doku.php?id=routing:building_routes_with_subdirectories">http://kerkness.ca/wiki/doku.php?id=routing:building_routes_with_subdirectories</a></p>
<p>Probably something like:</p>
<p>Route::set(&#39;backoffice/user&#39;, &#39;user/(&lt;action&gt;(/&lt;id&gt;))&#39;)
    -&gt;defaults(array(
        &#39;controller&#39; =&gt; &#39;user&#39;,
        &#39;action&#39;     =&gt; &#39;index&#39;,
        &#39;id&#39;       =&gt; NULL,
    ));</p>
<p>I haven&#39;t tried this out.</p>
<p><strong><a href="#312" title="2011-02-04 20:04:18">Sam</a>:</strong> Hi Mikito,</p>
<p>It&#39;s me again...  I installed your code and everything was working fine last week but now the facebook login button no longer works.  I can&#39;t even click it.  Any idea?  (<a href="http://app.babynamemo.com">http://app.babynamemo.com</a>).  Thanks in advance!</p>
<p><strong><a href="#313" title="2011-02-04 21:21:52">Mikito Takada</a>:</strong> Tried it out with my test account, signup via Facebook works for me on your site. If you haven&#39;t changed the code for the post-login logic, then the problem is with your browser...</p>
<p>If you find a specific, reproducible problem and are sure that the problem is with my module then file a bug in Github (&quot;no longer works&quot; is not a bug since it&#39;s not specific or reproducible). Even better, fork the code and send me a pull request with a fix.</p>
<p>While I appreciate people using my code, I don&#39;t do individual support/debugging :) -- except via blogging/tutorials/occasional comments which is much more efficient than personalized support... I think it&#39;s better for me to use any free time on improving the code further rather than providing support.</p>
<p><strong><a href="#314" title="2011-02-04 21:43:21">Sam</a>:</strong> Thanks Mikito!  I totally understand.  I just find it strange that it suddenly stopped working for me.  Thanks so much for looking into this for me.  I will file any bug in Github next time if I find anything.  =)</p>
<p><strong><a href="#315" title="2011-02-10 01:40:38">ellisgl</a>:</strong> Thanks for developing this. I do have a couple questions:</p>
<ol>
<li>Since 3.1.0 is out now, are you planning on updating the code to match?</li>
<li>It would be nice to have the session driver set via the config file.</li>
</ol>
<p><strong><a href="#316" title="2011-02-10 09:31:51">Mikito Takada</a>:</strong> 1) Yes, but I&#39;m swamped with work right now, so an upgrade to 3.1.0 will be coming in a couple of weeks unless someone else wants to do it... The problem is that I have no paid Kohana projects right now, so work on Useradmin comes out of my free time budget.
2) I&#39;ll add that to the wishlist.</p>
<p><strong><a href="#317" title="2011-02-24 12:16:46">Jam</a>:</strong> +1 for being able to use the native session driver, also adding the ability to set the $remember switch in the Auth ORM _login method would be awesome too.</p>
<p><strong><a href="#318" title="2011-02-25 01:11:42">Enrique</a>:</strong> Hi, how can I download your code? I can&#39;t find the link...
Thanks!</p>
<p><strong><a href="#319" title="2011-02-25 01:16:02">Mikito Takada</a>:</strong> <a href="http://blog.mixu.net/2010/09/14/kohana-3-auth-sample-implementation-and-documentation/">http://blog.mixu.net/2010/09/14/kohana-3-auth-sample-implementation-and-documentation/</a></p>
<p><strong><a href="#320" title="2011-02-25 06:24:37">Sam M</a>:</strong> Thanks for developing this great resource.</p>
<p>Although I believe I found an error in the most recent version of useradmin I downloaded. When attempting to log in without the correct login or password (or just nothing at all). I would get an error in &quot;MODPATH/user/classes/controller/useradmin/user.php&quot; on line 289.  It was:</p>
<p>ErrorException [ Fatal Error ]: Call to a member function errors() on a non-object</p>
<p>This line:</p>
<p>$view-&gt;set(&#39;errors&#39;, $status-&gt;errors(&#39;login&#39;));</p>
<p>I replaced $status with $_REQUEST and the problem seemed to be fixed.</p>
<p><strong><a href="#321" title="2011-02-25 12:53:52">greg</a>:</strong> Hey, I found it very useful but I have one problem. I am getting an error (if the login or password is wrong) when I am trying to login:</p>
<p>ErrorException [ Fatal Error ]: Call to a member function errors() on a non-object
MODPATHuserclassescontrolleruseradminuser.php [ 289 ]
284             if ($status) {
285                // redirect to the user account
286                Request::instance()-&gt;redirect(&#39;user/profile&#39;);
287             } else {
288                // Get errors for display in view
289                $view-&gt;set(&#39;errors&#39;, $status-&gt;errors(&#39;login&#39;));
290             }
291          }
292          $view-&gt;set(&#39;facebook_enabled&#39;, Kohana::config(&#39;useradmin&#39;)-&gt;facebook);
293          $this-&gt;template-&gt;content = $view;
294       }</p>
<p>Any idea what&#39;s wrong?</p>
<p>Thanks in advance.</p>
<p><strong><a href="#322" title="2011-02-25 13:09:14">Mikito Takada</a>:</strong> Yeah, see Sam M&#39;s comment above (it was stuck in moderation queue for a while). The fix will be built-in in the next release (which comes with awesome UI and Twitter+Google+Yahoo support).</p>
<p><strong><a href="#323" title="2011-02-25 14:44:02">greg</a>:</strong> Sorry, I didn&#39;t notice the post above when I was typing. I am bit distracted today.</p>
<p>Sam&#39;s solution works like a charm. I just replaced the:</p>
<p>$status-&gt;errors(‘login’)</p>
<p>with:</p>
<p>$_REQUEST-&gt;errors(‘login’)</p>
<p>One more thing. If I won&#39;t be using $_GET method can I replace the $_REQUEST with the $_POST? It should work fine also, right?</p>
<p>About next release - awesome dude! When are you going to release it? Anytime soon? It will be working on kohana 3.0 or 3.1?</p>
<p>Great job!</p>
<p><strong><a href="#324" title="2011-02-27 23:19:33">Mikito Takada</a>:</strong> The new release is out NOW!</p>
<p>It&#39;s still Kohana 3.0.x based, but there will eventually be support for Kohana 3.1.x - when I have more time...</p>
<p>(Edit: KO 3.1.x is now supported.)</p>
<p><strong><a href="#325" title="2011-03-09 05:06:59">neovive</a>:</strong> Just wanted to say thank you for all of the great tutorials and modules on your blog.</p>
<p><strong><a href="#326" title="2011-03-24 15:06:48">Seb</a>:</strong> Hey, awesome module - seriously good stuff! Will be adding the facebook/twitter image grab functions for you and will email you the code once done.</p>
<p>Just quickly tho, I&#39;m getting the error&quot;Retrieving information from the provider failed. Please register below.&quot; when trying to login via facebook, any suggestions?</p>
<p>Facebook privacy settings are good, everything installed as per your instructions (i think)...</p>
<p><strong><a href="#327" title="2011-03-24 15:30:22">Mikito Takada</a>:</strong> Great! The error &quot;Retrieving information from the provider...&quot; is usually caused by having an invalid API key so that the result from Facebook cannot be verifies properly.</p>
<p>Check your config/facebook.php and try printing out $_REQUEST before calling       if($provider-&gt;verify()) { in useradmin / classes / controller / useradmin / user.php to get the returned values..</p>
<p>Also, you might want to try to throw the exception from useradmin / classes / provider / facebook.php verify() to get more information...</p>
<p><strong><a href="#328" title="2011-03-28 00:15:11">Zoran Ivancevic</a>:</strong> Hi,
is there any way I can use this module with Doctrine instead of the default ORM?
I guess I could use the ORM just for you plugin, and Doctrine for everything else, but that could be really messy.</p>
<p><strong><a href="#329" title="2011-03-31 12:17:27">Cieply</a>:</strong> When i&#39;m trying to create new account get this error:
ErrorException [ Fatal Error ]: Call to undefined method Auth_File::register()</p>
<p>MODPATH/user/classes/controller/useradmin/user.php [ 179 ]</p>
<p>Kohana 3.1.2</p>
<p><strong><a href="#330" title="2011-03-31 18:51:47">Mikito Takada</a>:</strong> Sorry, Useradmin is tested/meant to be used with Auth_ORM (e.g. you need to use ORM and the ORM Auth driver).</p>
<p>The Auth_File driver is not supported by Useradmin, the recent code updates improved the level of abstraction but I don&#39;t use Auth_File so I don&#39;t test with it. You need to port the Auth_ORM extensions to Auth_File yourself or use the ORM driver.</p>
<p><strong><a href="#331" title="2011-03-31 19:39:14">Zoran Ivancevic</a>:</strong> I managed to get your module running with doctrine.
Twitter, google and yahoo work fine, but with Facebook I&#39;m having the same problem as Seb: &quot;Retrieving information from the provider failed. Please register below.&quot;</p>
<p>It is failing in the vendor file, function getSession(). Session seems always to be NULL. It is in the $_REQUEST.</p>
<p>My api key is fine. I checked a few times.</p>
<p>Any suggestions?</p>
<p><strong><a href="#332" title="2011-03-31 20:04:31">Mikito Takada</a>:</strong> Hi Zoran, awesome! I have been looking into using Doctrine if I do a big project with Kohana.</p>
<p>About the problem: you mean this file?</p>
<p><a href="https://github.com/mixu/useradmin/blob/master/vendor/facebook/src/facebook.php">https://github.com/mixu/useradmin/blob/master/vendor/facebook/src/facebook.php</a></p>
<p>Then the problem is with Facebook&#39;s own PHP SDK.</p>
<p>If you are on Windows, then you might have problems with curl having old certificates (there is a loooong thread on this on the Facebook SDK PHP: <a href="https://github.com/facebook/php-sdk/issues/7">https://github.com/facebook/php-sdk/issues/7</a> ). Generally my impression is that Facebook&#39;s own library seems to have a lot of issues and the documentation is rather confusing.</p>
<p>See also: <a href="https://github.com/facebook/php-sdk/issues">https://github.com/facebook/php-sdk/issues</a></p>
<p>Useradmin only does a lightweight wrapper (<a href="https://github.com/mixu/useradmin/blob/master/classes/provider/facebook.php">https://github.com/mixu/useradmin/blob/master/classes/provider/facebook.php</a> ) around the Facebook PHP SDK - so if you have the rest of the module working, then the problem is with Facebook&#39;s own library...</p>
<p><strong><a href="#333" title="2011-03-31 20:16:21">Zoran Ivancevic</a>:</strong> Yes, that file.
In fuction getSession()</p>
<p>// try loading session from $_REQUEST
      if (!$session &amp;&amp; isset($_REQUEST[&#39;session&#39;])) {
        $session = json_decode(
          get_magic_quotes_gpc()
            ? stripslashes($_REQUEST[&#39;session&#39;])
            : $_REQUEST[&#39;session&#39;],
          true
        );
        print_r($_REQUEST[&#39;session&#39;]); //bugtrace
        print_r($session); //bugtrace
        $session = $this-&gt;validateSessionObject($session);
      }</p>
<p>first print_r outputs b63a1f2864504778eb2e7b6fc0b8bfed
second print_r outputs nothing</p>
<p><strong><a href="#334" title="2011-03-31 20:32:02">Zoran Ivancevic</a>:</strong> Maybe the return from facebook is not set up right.
Can you just tell me what should I put in facebook dev under site URL:
<a href="http://mysite.com/">http://mysite.com/</a>
<a href="http://mysite.com/user/">http://mysite.com/user/</a>
<a href="http://mysite.com/user/provider/">http://mysite.com/user/provider/</a>
<a href="http://mysite.com/user/provider_return/">http://mysite.com/user/provider_return/</a>
?</p>
<p><strong><a href="#335" title="2011-03-31 20:56:19">Mikito Takada</a>:</strong> The return URL should be:</p>
<p><a href="http://mysite.com/user/provider_return/facebook">http://mysite.com/user/provider_return/facebook</a></p>
<p><strong><a href="#336" title="2011-04-04 14:04:54">Harry</a>:</strong> Hello, Mikito!</p>
<p>Thank you for the enormous effort you&#39;ve put in the module.</p>
<p>I have a problem when I try to register a user:</p>
<p>Call to undefined method Auth_File::register()</p>
<p> in line 179 in</p>
<p>MODPATHuserclassescontrolleruseradminuser.php</p>
<p>The line says:</p>
<p>Auth::instance()-&gt;register( $_POST, TRUE );</p>
<p>And after browsing through all of the classess declarations I found that the instance method should return an object of the class Auth_ORM (or from a class which extends Auth_ORM). But instead of that it returns an object from Auth_File class which doesn&#39;t have register method of course.</p>
<p>The problem obviously is happening in the instance method in modules/classes/kohana/auth.php :</p>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">instance</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">isset</span>(Auth::<span class="hljs-variable">$<em>instance</span>))
    {
        <span class="hljs-comment">// Load the configuration for this type</span>
        <span class="hljs-variable">$config</span> = Kohana::config(<span class="hljs-string">&#39;auth&#39;</span>);

        <span class="hljs-keyword">if</span> ( ! <span class="hljs-variable">$type</span> = <span class="hljs-variable">$config</span>-&amp;gt;get(<span class="hljs-string">&#39;driver&#39;</span>))
        {
            <span class="hljs-variable">$type</span> = <span class="hljs-string">&#39;file&#39;</span>;
        }

        <span class="hljs-comment">// Set the session class name</span>
        <span class="hljs-variable">$class</span> = <span class="hljs-string">&#39;Auth</em>&#39;</span>.ucfirst(<span class="hljs-variable">$type</span>);

        <span class="hljs-comment">// Create a new session instance</span>
        Auth::<span class="hljs-variable">$_instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable">$class</span>(<span class="hljs-variable">$config</span>);
    }

    <span class="hljs-keyword">return</span> Auth::<span class="hljs-variable">$_instance</span>;
}</code></pre><p>I&#39;ve thought I have a problem with the configuration in bootstrap.php, but it&#39;s the same as provided in the tutorial.</p>
<p>Could you please help me?</p>
<p><strong><a href="#337" title="2011-04-04 18:27:59">Andres</a>:</strong> Hi Mikito, I only can say: &quot;Good Job, man!&quot;. Thanks!</p>
<p>Useradmin works right, so taking a look to your schema.sql I can see that user_identity table has not a foreign key to users.id, no matter with this, but it&#39;s my little improvement :)</p>
<p>I&#39;m from Argentina and I&#39;m using i18n for internationalization (using my own es-ar translation... yes, I used your i18n auto-collector script!) but, reading your code, I can see that you forgotten some function &quot;__&quot; calls. I added this in my code, I would share my code with you soon.</p>
<p>Thanks again for sharing you code with us!</p>
<p><strong><a href="#338" title="2011-04-04 18:48:05">Mikito Takada</a>:</strong> Yeah, as the code you quote says if you don&#39;t configure the driver for the KO 3.1 core Auth, it will use the Auth_File driver, which is NOT supported  by Useradmin (at least not yet; it&#39;s just an early start for doing that abstraction but not sure that I will implement it). Make sure you have configured auth like in the section &quot;KO3.1 Auth configuration&quot; above.</p>
<p>Please use the ORM driver in /application/config/auth.php...</p>
<p><strong><a href="#339" title="2011-04-04 18:51:38">Mikito Takada</a>:</strong> Thanks Andres,  this comment made my day after feeling pretty tired! I probably missed some __ calls in the last upgrade, send me the code to firstname.surname at gmail.com (e.g. zipped). I&#39;ll do a merge next time I work on Useradmin.</p>
<p><strong><a href="#340" title="2011-04-05 04:37:34">Andres</a>:</strong> Hi Mikito, thanks for your reply!
I&#39;m testing all Useradmin features, but when Useradmin tries to send a mail (e.g. when I clicked in the forgot password link), I received a Error: ErrorException [ Fatal Error ]: Class &#39;Email&#39; not found
I added the Shadowhand email module for Kohana 3.x and the old banks kohana-email module, both with the same result.</p>
<p>In my application bootstrap, I have:</p>
<p>Kohana::modules(array(
    &#39;user&#39;        =&gt; MODPATH.&#39;user&#39;,     // Useradmin module
    &#39;auth&#39;        =&gt; MODPATH.&#39;auth&#39;,     // Basic authentication
    // &#39;cache&#39;      =&gt; MODPATH.&#39;cache&#39;,      // Caching with multiple backends
    // &#39;codebench&#39;  =&gt; MODPATH.&#39;codebench&#39;,  // Benchmarking tool
    &#39;database&#39;    =&gt; MODPATH.&#39;database&#39;,   // Database access
    // &#39;image&#39;      =&gt; MODPATH.&#39;image&#39;,      // Image manipulation
    &#39;orm&#39;            =&gt; MODPATH.&#39;orm&#39;,        // Object Relationship Mapping
    &#39;email&#39;     =&gt; MODPATH.&#39;email&#39;,      // Email module
    &#39;pagination&#39;    =&gt; MODPATH.&#39;pagination&#39;, // Pagination module
    // &#39;unittest&#39;   =&gt; MODPATH.&#39;unittest&#39;,   // Unit testing
    // &#39;userguide&#39;  =&gt; MODPATH.&#39;userguide&#39;,  // User guide and API documentation
    ));</p>
<p>Do you know why the system can&#39;t load the Email class?</p>
<p><strong><a href="#341" title="2011-04-05 20:12:01">Steve</a>:</strong> Thanks man, this saved me a lot of time and works fantastically so far.  The only issue I found was a call to Security::xss_clean() in the login function that didn&#39;t exist anymore, but I just changed it to HTML::chars to escape it instead and everything works great.  I&#39;ll let you know if I&#39;m able to implement any of your wish list features in the future.</p>
<p><strong><a href="#342" title="2011-04-14 01:15:11">Brent</a>:</strong> Hi, I am trying to set up the module but when trying to update my database with your schema in fails on any CREATE TABLE that includes foreign key constraints with error:
Error Code: 1005
Can&#39;t create table &#39;user_tokens&#39; (errno: 150)</p>
<p>Mysql docs suggest that a column name may match an internal table name. <a href="http://dev.mysql.com/doc/refman/5.0/en/innodb-error-codes.html">http://dev.mysql.com/doc/refman/5.0/en/innodb-error-codes.html</a></p>
<p>Any ideas anyone?</p>
<p><strong><a href="#343" title="2011-04-16 22:39:29">Jan Daniel</a>:</strong> Hello, maybe you should use HTML::.. methods with last attribute TRUE - without it module styling and links will not work on application which doesnt use clean URLs.</p>
<p>I am pretty new to Kohana and takes me a while to solve where is a problem.</p>
<p><strong><a href="#344" title="2011-04-21 14:13:26">Shoaibi</a>:</strong> Have i missed it or is there no example routes file for this module?</p>
<p><strong><a href="#345" title="2011-04-21 14:25:53">Mikito Takada</a>:</strong> You don&#39;t need extra routing for most of the functionality, since the default /controller/action routes are fine e.g. /user/login/ =&gt; Controller_User -&gt; action_login. The few additional routes for Useradmin are defined in the init.php file.</p>
<p><strong><a href="#346" title="2011-04-21 14:36:39">Shoaibi</a>:</strong> great...
One more question.
I have got Facebook, Google, Yahoo and Recaptcha working. Twitter gives: ErrorException [ Fatal Error ]: Class &#39;OAuth_Consumer&#39; not found</p>
<p>whereas oauth is enabled in bootstrap. Did i miss a module?</p>
<p><strong><a href="#347" title="2011-04-21 14:43:12">Shoaibi</a>:</strong> One word, AWESOME.
So well thought and organized, Keep the good work up.</p>
<p><strong><a href="#348" title="2011-04-21 14:52:46">Mikito Takada</a>:</strong> Yeah, you need Kohana-Oauth for Twitter support:</p>
<p><a href="https://github.com/kohana/oauth">https://github.com/kohana/oauth</a></p>
<p>If you need email support, you can try with banks Kohana-Email module, but I will need to give that part of the code another look to ensure 3.1.x compatibility for email sending.</p>
<p><strong><a href="#349" title="2011-04-21 14:58:39">Shoaibi</a>:</strong> had a typo there, fixed that, working great.</p>
<p>Btw, any chances of adding user email activation support before one can login?</p>
<p><strong><a href="#350" title="2011-04-21 15:14:13">Mikito Takada</a>:</strong> Maybe closer to the summer when I get a chance to recheck the email code, but for now, I have no free time! If you build it, I&#39;ll include it in the module, however.</p>
<p><strong><a href="#351" title="2011-05-04 19:39:02">Dinesh Shah</a>:</strong> Mikito,</p>
<p>Your module is awesome. I am investigating it if I can use it my apps. It sure will help me with implementing my own auth. :-)</p>
<p>How do I submit a patch for changes I made to make it compatible with KO 3.1?</p>
<p>This patch uses Shadowhand&#39;s email module instead of Bank&#39;s which is not(?) compatible with KO 3.1 as discussed in this Kohana Forum Post - <a href="http://forum.kohanaframework.org/discussion/comment/58597#Comment_58597">http://forum.kohanaframework.org/discussion/comment/58597#Comment_58597</a></p>
<p>I have also removed/replace Security::xss_clean()call to PHP&#39;s filter_vars() in reset password method.</p>
<p>Once again thanks for your great work.</p>
<p>295c295,296</p>
<h2 id="set-username-security-xss_clean-_get-username-">set(&#39;username&#39;, Security::xss_clean($_GET[&#39;username&#39;]));</h2>
<p>&gt; //            $view-&gt;set(&#39;username&#39;, Security::xss<em>clean($<em>GET[&#39;username&#39;])); // KO 3.1 removed this method from Security class
&gt;             $view-&gt;set(&#39;username&#39;, filter<em>var($<em>GET[&#39;username&#39;], FILTER<em>SANITIZE<em>STRING));
339c340,345
             /<em>
&gt;              </em> Changes made to use shadowhand&#39;s email module (wrapper for SwiftMailer)
&gt;              */
&gt;
&gt; //            $mailer = Email::connect();
&gt;             $mailer = Email::factory();
342,345c348,355
&lt;             $subject = <strong>(&#039;Account password reset&#039;);
&lt;             $to = $_POST[&#039;reset_email&#039;];
email_address;
 //            $subject = </strong>(&#39;Account password reset&#39;);
&gt;             $mailer-&gt;subject(__(&#39;Account password reset&#39;));
&gt; //            $to = $_POST[&#39;reset_email&#39;];
&gt;             $mailer-&gt;to($_POST[&#39;reset_email&#39;]);
&gt; //            $from = Kohana::config(&#39;useradmin&#39;)-&gt;email_address;
&gt;             $mailer-&gt;from(Kohana::config(&#39;useradmin&#39;)-&gt;email_address);
&gt; //            $body =  </em></em>($message, array(
&gt;             $mailer-&gt;message(</em></em>($message, array(
350,355c360,367
&lt;             ));
&lt;             $message_swift = Swift_Message::newInstance($subject, $body)
setFrom($from)
setTo($to);
send($message_swift)) {
             )));
&gt; //            $message_swift = Swift_Message::newInstance($subject, $body)
&gt; //                    -&gt;setFrom($from)
&gt; //                    -&gt;setTo($to);
&gt;
&gt; //            if($mailer-&gt;send($message_swift)) {
&gt;             if($mailer-&gt;send()) {
&gt;              Message::add(&#39;success&#39;, </em></em>(&#39;Password reset email sent.&#39;));</p>
<p><strong><a href="#352" title="2011-05-09 13:45:59">Carnevalle</a>:</strong> Hi Mikito,</p>
<p>Thank you for an awesome module. I am still trying to get my head around Kohana and how to extend your module with my own pages, but for now I too am struggling with getting the Facebook connect to work.</p>
<p>I have, to the best of my knowledge, setup the API keys in the config file and configured the canvas URLS in my app to <a href="http://actualskill.com/beta/user/provider_return/facebook/">http://actualskill.com/beta/user/provider_return/facebook/</a></p>
<p>Whenever I try to register a new user or connect a user to Facebook it just redirects me to facebook.com. There is no callback to my site.</p>
<p><strong><a href="#353" title="2011-05-12 20:24:11">Jean-Nicolas Boulay Desjardins</a>:</strong> This is the error I get:</p>
<p>ErrorException [ Fatal Error ]: Call to undefined method Auth_ORM::register()</p>
<p>It does not make any sense...</p>
<p>in my boot* I have added orm and auth... I can not see why I am getting this error.</p>
<p>Thanks Mixu in advance :)</p>
<p><strong><a href="#354" title="2011-05-12 22:31:56">Mikito Takada</a>:</strong> For future readers: We talked this over, answer is that you should load the Useradmin module before the Auth module, since otherwise the wrong file gets loaded (Useradmin extends the Core auth a little).</p>
<p><strong><a href="#355" title="2011-05-14 04:20:12">Jack</a>:</strong> Would just like to add that if you are receiving a benchmark page when you extend Controller_App, that you need to set auto_render to false.</p>
<p>public $auto_render = FALSE;</p>
<p><strong><a href="#356" title="2011-05-26 17:51:19">Dinesh Shah</a>:</strong> Mikito,</p>
<p>I would like to use email for all actions (login etc.). I do not want to keep &#39;username&#39; column in my user table.</p>
<p>I have tried to over ride rules() in Model_User without success. :-(</p>
<p>Any pointers?</p>
<p>Thanks for your time.</p>
<p><strong><a href="#357" title="2011-05-27 16:08:47">Daniel Ribeiro Gomes</a>:</strong> Hey man, how are you doing?</p>
<p>I&#39;ve been working with this module for sometime now, and i&#39;m having a trouble related to the Session Database Driver.</p>
<p>Somehow, when I set the default adapter to be the database adapter on bootstrap, like this:</p>
<p>Session::$default = &quot;database&quot;;</p>
<p>I get a lost of failures on the test batteries, usually related to login actions.</p>
<p>I&#39;m currently using Kohana 3.1.x, with Useradmin module enabled.</p>
<p>Does anyone have an idea about that?</p>
<p>Thanks!</p>
<p><strong><a href="#358" title="2011-06-07 18:36:36">Chris</a>:</strong> My database is throwing an exception because in the schema,  <code>last_failed_login</code> datetime NOT NULL so when I create a user I&#39;m getting:
Database_Exception [ 1364 ]: Field &#39;last_failed_login&#39; doesn&#39;t have a default value</p>
<p><strong><a href="#359" title="2011-06-11 02:24:01">Marcelo Rodrigo</a>:</strong> Your module is really awesome, good job!
A hug from Brazil</p>
<p><strong><a href="#360" title="2011-06-22 22:03:25">Sam</a>:</strong> @Zoran - Did you figure out how to get the Facebook API to work? I&#39;m having the exact same problem as you and have traced it to the same getSession() function.  Not sure why the session is not coming back.</p>
<p><strong><a href="#361" title="2011-06-22 22:23:25">Sam</a>:</strong> Alright, I found the problem. For some reason the &#39;session&#39; variable from $_GET[&#39;session&#39;] cannot be obtained using $_REQUEST[&#39;session&#39;].  I was able to see the session variable passed in thru the address bar.  So what I did was commented the section with $_REQUEST and replaced it with this:</p>
<pre class="hljs"><code>  <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$session</span> &amp;amp;&amp;amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#39;session&#39;</span>])) {
    <span class="hljs-variable">$session</span> = json_decode(
      get_magic_quotes_gpc()
        ? stripslashes(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#39;session&#39;</span>])
        : <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#39;session&#39;</span>],
      <span class="hljs-keyword">true</span>
    );
    <span class="hljs-variable">$session</span> = <span class="hljs-variable">$this</span>-&amp;gt;validateSessionObject(<span class="hljs-variable">$session</span>);
  }</code></pre><p>Now it works but when I try to register with a Facebook login, it tells me that it cannot obtain all the required information and the user still need to fill out the form.  It works fine if you already have an account and just associate your Facebook account with it.</p>
<p><strong><a href="#362" title="2011-06-30 13:20:12">Maz</a>:</strong> Thanks for this awesome module! But i still have problems with the email module on K3.1.. Is there any fix for new module for this?</p>
<p><strong><a href="#363" title="2011-06-30 13:20:54">Maz</a>:</strong> Could you possibly upload the module? :-)</p>
<p><strong><a href="#364" title="2011-07-01 12:10:13">Dinesh Shah</a>:</strong> @Maz,</p>
<p>I do not have commit access yet.</p>
<p><strong><a href="#365" title="2011-07-01 12:11:47">Dinesh Shah</a>:</strong> @Mikito,</p>
<p>I would like to add Roles Management in this module.</p>
<p>How do I submit patch/files?</p>
<p><strong><a href="#366" title="2011-07-14 08:49:10">k2011</a>:</strong> I am getting a &quot;The page isn&#39;t redirecting properly&quot;  once the user logs in. Anyone with an idea of how this can be resolved? Thanks</p>
<p><strong><a href="#367" title="2011-07-30 02:24:05">robo</a>:</strong> Awsome,</p>
<p>do you plan to write about acount validation via a link in an email?
is this feature included in auth?</p>
<p><strong><a href="#368" title="2011-08-26 18:09:19">buggy-13</a>:</strong> I hava a question about validating register form.</p>
<p>userclassesuseradminmodeluser.php</p>
<p>public function rules()
    {
        $parent = parent::rules();
        // fixes the min_length username value
        $parent[&#39;username&#39;][1] = array(&#39;min_length&#39;, array(&#39;:value&#39;, 1));
        return $parent;
    }</p>
<p>I have checked and I think line &#39;$parent[&#39;username&#39;][1] &#39;
overrides:
array(&#39;max_length&#39;, array(&#39;:value&#39;, 32)),</p>
<p>is it correct?</p>
<p>I use Kohana 3.2</p>
<p><strong><a href="#369" title="2011-08-30 20:31:21">Crates</a>:</strong> I have a copy of this suite updated for Kohana 3.2 if anyone wants it. Send me an e-mail (typing at gmail dot com) if you want a copy.</p>
<p><strong><a href="#370" title="2011-09-02 20:14:23">Nightnyt</a>:</strong> @Crates
send me one :)  NightFightNight@gmail.com</p>
<p><strong><a href="#371" title="2011-09-05 09:55:47">Lyndon</a>:</strong> I&#39;v also ported this to ko3.2.
I had a lot of issues with getting the user_identity table to work. It didn&#39;t help that there were multiple versions of the database with different table names. In the end I worked out that it was converting the table name user_identity to user_identities because of the ORM $_table_names_plural value. After fixing that and making a few other small changes everything seems to be working fine.</p>
<p>Does anyone know if the introduction of $_table_names_plural to the ORM module is new to 3.2? I dont even understand why it would be used....</p>
<p>Let me know if people will be interested in the updated module and I&#39;ll make it publicly available.</p>
<p><strong><a href="#372" title="2011-09-05 10:39:24">dex</a>:</strong> send me one too please     denhimera753@gmail.com
:)</p>
<p><strong><a href="#373" title="2011-09-07 21:00:36">Nightnyt</a>:</strong> we can work to create a basic tutorial on how the framework works. like basic login, registration, fetching data etc.</p>
<p>im just planning to make one soon, but im still new on this. so 3.2 would be a great start.</p>
<p><strong><a href="#374" title="2011-09-11 05:36:48">Crates</a>:</strong> Yeah, I had the same problem with the pluralities. There are still some issues I&#39;m working out with the retrieval and commitment of data in the user management screen; the creation of the users is working but the view/edit is screwy. Lyndon, if you&#39;ve already worked that out, e-mail me (typing@gmail.com); if not, well, I should have it taken care of in a day or two.</p>
<p>There&#39;s already been like seven people requesting me via e-mail for the finished copy of this script, and my boss really wants it too (^_^) so I should be able to hook everyone up very soon.</p>
<p><strong><a href="#375" title="2011-09-11 22:10:00">Crates</a>:</strong> Okay... I&#39;m almost done with the changes to the 3.2 port and I&#39;ve created a Google Code project for anyone who wants to help to maintain it or wants a copy in the future.</p>
<p>Mikito, please e-mail me (typing@gmail.com) if you are reading this because I could REALLY use some advice to expedite the completion of this migration.</p>
<p>Right now I&#39;m working on resolving some issues with OAuth, as that component is still only partially working.</p>
<p><strong><a href="#376" title="2011-09-13 21:36:57">Jeremie Weldin</a>:</strong> @crates: why not just fork the project on github?</p>
<p><strong><a href="#377" title="2011-09-14 06:22:46">Jeremie Weldin</a>:</strong> &quot;If you just need an extra field, you can add that in the database. The code for saving users is flexible enough that it will save new fields if they exist in the database.&quot;</p>
<p>I noticed that when attempting to add new fields to the user table, you can&#39;t just add fields to the database and then modify the views.  The register method of Useradmin_Auth_ORM calls:</p>
<p>$user-&gt;create_user($fields, array(
                &#39;username&#39;,
                &#39;password&#39;,
                &#39;email&#39;,
            ));</p>
<p>which sets the expected fields to only the 3 specified.  In order to add fields to the user you would need to pass NULL for the expected fields or add your custom fields to the array.</p>
<p>Please correct me if I am wrong.</p>
<p><strong><a href="#378" title="2011-09-14 22:18:13">Kenny</a>:</strong> I managed to get everything to work in Ko 3.2 — update the Controller Action Parameters in user.php as the conventions have changed and the provider_name was returning null so I put:
$provider_name = $this-&gt;request-&gt;param(&#39;provider&#39;);</p>
<p>Also gotta update oauth with the patch Revision 78867c4b from the kohana repo.</p>
<p>And some other things too, but for me those seemed to be the key things...</p>
<p>Don&#39;t forget to update any references from user_identity to user_identities...</p>
<p>Thanks to Mixu for putting this together, it&#39;s a great way to get into Kohana.</p>
<p><strong><a href="#379" title="2011-09-22 12:23:36">Enigma</a>:</strong> Hi Kenny/ Crate ... can you share the working 3.2 code for useradmin .... kindly let me ... im quite to kohana ... just want to start now ... kindly help me</p>
<p><strong><a href="#380" title="2011-09-22 22:32:11">Enigma</a>:</strong> Kohana 3.2 Modules Changes</p>
<p>Just be brave and copy the 3.1 module enable it and set it as mentioned above.</p>
<ol>
<li><p>The first issue would the table name &#39;user_identities &#39; .... just rename the table &#39;user_identity&#39;  to user_identities.</p>
</li>
<li><p>Just login and It will look like everything is working then you would find that pagination has a issue just change &#39;Kohana::config&#39; to Kohana::$config-&gt;load</p>
</li>
<li><p>All set now for your own auth .. now lets look at the providers ... you try to connect but you would be getting &#39;Provider is not enabled; please select another provider or log in normally.&#39; The providers are enabled by default ... but the issue is $provider_name = null ... search for it and right below it add this line</p>
</li>
</ol>
<h2 id="-provider_name-this-gt-request-gt-param-id-">$provider_name = $this-&gt;request-&gt;param(‘id’);</h2>
<h2 id="kenny-s-suggesting-didnt-work-for-me-just-debug-var-this-gt-request-provider_name-this-gt-request-gt-param-provider-is-not-right-param-id-seems-to-be-the-right-one-">Kenny&#39;s suggesting didnt work for me...  just Debug::var($this-&gt;request) ... $provider_name = $this-&gt;request-&gt;param(‘provider’) is not right , param(&#39;id&#39;) seems to be the right one.</h2>
<p>I will keep posting updates as i digg through it and its just a while since i started :) hope we will be having a complete working port here soon .... guys if im missing something kindly correct me ... this is one of the core modules and its very important its up to date ... lets share the pain :)</p>
<p><strong><a href="#381" title="2011-09-26 22:04:26">Kon kana</a>:</strong> Can anyone share the latest or 3.2 based version link....</p>
<p><strong><a href="#382" title="2011-10-08 21:18:34">bigredc2</a>:</strong> I would love if you could send me your 3.2 port of this.  My email is (bigredc at hotmail)</p>
<p><strong><a href="#383" title="2011-10-11 21:58:38">John</a>:</strong> Thank-you very much Mixu.</p>
<p>This would have to be one of the best resources (the documentation and discussion) out there and it is exactly what I am looking for.</p>
<p>Would love a 3.2 version, or some help....</p>
<p>I changed table to user_identities...
I added a default value for users.last_failed_login
Now I have not &#39;an instance of Validation&#39; in user.php on line 217.</p>
<p>I appreciate modules and documentation like this.... to learn from, to leverage off,... but (unfortunately) I am almost good enough to be a user of these tools, but not a developer of....</p>
<p>Any pointers or assistance greatly appreciated. If anyone has code that works with Kohanan 3.2 then I&#39;d love a copy. :-) Thank-you</p>
<p><strong><a href="#384" title="2011-10-20 10:41:28">Enigma</a>:</strong> Do u have a working 3.2 copy ? if anyone does kindly mail me at lvlr.enigma@@at@@gmail.com</p>
<p><strong><a href="#385" title="2011-10-20 13:04:57">Enigma</a>:</strong> 4.     MODPATHpaginationclasseskohanapagination.php [ 199 ]</p>
<p>change</p>
<p>return URL::site(Request::current()-&gt;uri).URL::query(array($this-&gt;config[&#39;current_page&#39;][&#39;key&#39;] =&gt; $page));</p>
<p>to</p>
<p>return URL::site(Request::current()-&gt;uri()).URL::query(array($this-&gt;config[&#39;current_page&#39;][&#39;key&#39;] =&gt; $page));</p>
<p>current()-&gt;uri become current()-&gt;uri()</p>
<p>to be continued .... im going to add the changes as they come .... hope im going the right way and the community notices this .... 3.2 migration is really needed ... and almost a month since i looked in to it but ... guys lets close this off today :) ...</p>
<p><strong><a href="#386" title="2011-10-20 13:51:21">Enigma</a>:</strong> 5. MODPATHuserclassesuseradmincontrolleradminuser.php [ 76 ]</p>
<p>change</p>
<p>public function action_edit($id= NULL)
    {
to</p>
<p>public function action_edit()
    {
        $id = $this-&gt;request-&gt;param(&#39;id&#39;, NULL);</p>
<p>to be continued.....</p>
<p><strong><a href="#387" title="2011-10-20 14:04:51">Enigma</a>:</strong> 6. MODPATHuserclassesuseradmincontrolleradminuser.php [ 218 ]</p>
<pre class="hljs"><code>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">action_delete</span><span class="hljs-params">(<span class="hljs-variable">$id</span>=NULL)</span>
</span>{

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">action_delete</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$this</span>-&amp;gt;request-&amp;gt;param(<span class="hljs-string">&#39;id&#39;</span>, <span class="hljs-keyword">NULL</span>);</code></pre><p><strong><a href="#388" title="2011-10-20 20:36:39">Palkonyves</a>:</strong> First of all, some changes I deeded for Kohana v3.2:</p>
<p>-- Fixing errors of &#39;table  .user_identities not found&#39;:</p>
<pre class="hljs"><code><span class="hljs-keyword">in</span> useradmin<span class="hljs-regexp">/classes/</span>useradmin<span class="hljs-regexp">/model/</span>user/identity.php add the following ORM <span class="hljs-string">property:</span></code></pre><p>   protected $_table_name = &quot;user_identity&quot;;</p>
<p>-- Fixing pagination errors for user admin, you have to touch the pagination module in
    pagination/classes/kohana/pagination.php in line 92:
    $config_file = Kohana::$config-&gt;load(&#39;pagination&#39;)</p>
<p>Otherwise This is a really good working example of a neatly constructed Kohana module. I would do some decomposition for example in user_admin/edit, but otherwise it is very well structured.</p>
<p>checking out the template files I realized the existence of a Datatable helper, which is something I started to and wanted to implement.</p>
<p>Thanks for this module</p>
<p><strong><a href="#389" title="2011-10-21 09:28:20">Enigma</a>:</strong> Kindly follow my updates ... im almost done with porting except facebook twitter and captcha validation ... hopefully it will be done today .. if u are interested in joinin wud be great</p>
<p><strong><a href="#390" title="2011-10-21 10:21:23">otakurzo</a>:</strong> SOLUTIONS for Kohana 3.1</p>
<p>[b]1. Routing fail with providers[/b]</p>
<p>classesuseradmincontrolleruser.php
Functions:</p>
<ul>
<li>action_provider</li>
<li>action_associate</li>
<li>action_associate_return</li>
<li>action_provider_return</li>
</ul>
<p>Remove the parameters &quot;$provider_name = NULL&quot; and
below put
$provider_name = $this-&gt;request-&gt;param(&#39;provider&#39;);</p>
<p>[b]2. Facebook: getSession deprecated in PHP SDK 3.x[/b]
classesuseradminproviderfacebook.php
Change &quot;getSession&quot; to &quot;getUser&quot;.
Reference: <a href="http://developers.facebook.com/blog/post/503/">http://developers.facebook.com/blog/post/503/</a></p>
<p><strong><a href="#391" title="2011-10-23 18:55:45">Palkonyves</a>:</strong> I will use this module in a bigger project (obviusly :) and I will need a group management. When I implement it, I&#39;ll be glad to merge the improvement.</p>
<p><strong><a href="#392" title="2011-10-26 22:26:14">Enigma</a>:</strong> 7.  Twitter and Facebook integration are very well inbuilt ... but need little tweaks</p>
<p>Twitter :  place ca-bundle.crt in config directory.
if you dont know where to find ca-bundle.crt goto <a href="http://curl.haxx.se/docs/caextract.html">http://curl.haxx.se/docs/caextract.html</a> download cacert.pem and rename it to ca-bundle.crt</p>
<p>Facebook:  classes/useradmin/provider/facebook.php [43]</p>
<p>replace</p>
<pre class="hljs"><code>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">verify</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">if</span> ($<span class="hljs-keyword">this</span>-&amp;gt;facebook-&amp;gt;getSession())
    {</code></pre><p>with</p>
<pre class="hljs"><code><span class="hljs-keyword">public</span> function verify()
{
    <span class="hljs-variable">$this</span><span class="hljs-subst">-&amp;</span><span class="hljs-literal">gt</span>;uid <span class="hljs-subst">=</span> <span class="hljs-variable">$this</span><span class="hljs-subst">-&amp;</span><span class="hljs-literal">gt</span>;facebook<span class="hljs-subst">-&amp;</span><span class="hljs-literal">gt</span>;getUser();
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$this</span><span class="hljs-subst">-&amp;</span><span class="hljs-literal">gt</span>;uid)
    {</code></pre><p>both facebook and twitter login are not properly bakedup ... they are working as associations . new registrations fails and prompts the user for email and password .... is this behavior expected .... i personally think there could be a better way to handle new registrations using twitter and facebook :)</p>
<p><strong><a href="#393" title="2011-10-27 04:33:09">Enigma</a>:</strong> just an amendment for the previous post ... twitter doet provide email and hence we hv no other option to go around it ... but with facebook the issue is with the update in the facebook php sdk ...</p>
<p>&quot;the req_perms parameter has been changed to scope &quot;</p>
<p>Facebook: classes/useradmin/provider/facebook.php [35]</p>
<p>change req_perms to scope</p>
<p><strong><a href="#394" title="2011-11-17 15:12:38">Robert C</a>:</strong> Can you please send me a copy?</p>
<p>robert AT dubbel16 DOT nl</p>
<p><strong><a href="#395" title="2011-11-21 17:01:19">samuele</a>:</strong> i have problems with config load,
the setup is ok but i have this error
Undefined index: max_failed_logins .</p>
<p>is like the useradmin config file wasn&#39;t read</p>
<p><strong><a href="#396" title="2011-11-28 00:48:57">Daniel Ribeiro</a>:</strong> I would like to understand why you didn&#39;t use the user_tokens table that comes with Auth module to store the reset password tokens.</p>
<p>Is there any specific reason to create the reset_token field?</p>
<p><strong><a href="#398" title="2011-12-09 04:31:27">Asummption</a>:</strong> user_token table is for remember me option ... its auto cleaned ... ie records are deleted after a specific period ... to make the reset password token independant from the remember me token ..</p>
<p><strong><a href="#399" title="2011-12-27 09:29:21">Gerald Yeong</a>:</strong> Thank you @Enigma, Just wanted to thank you for your hardwork. Thanks mixu for developing this from the start and also the rest that kept this going.</p>
<p><strong><a href="#400" title="2011-12-29 20:52:31">SpaceDoG</a>:</strong> Has anyone fixed the issue with the page not redirecting properly after login?</p>
<p><strong><a href="#401" title="2011-12-30 03:52:25">SpaceDoG</a>:</strong> So I&#39;ve gotten everything working with the exception of facebook logins. It&#39;s set to true in the config and I&#39;ve updated the user.php controller to fix all of the nulls but it still won&#39;t work... Just keep getting the &quot;Provider is not enabled; please select another provider or log in normally.&quot; error. Any thoughts?</p>
<p><strong><a href="#402" title="2011-12-30 15:43:03">SpaceDoG</a>:</strong> I got em all working now.</p>
<p><strong><a href="#403" title="2012-01-03 01:49:35">Dave</a>:</strong> I found an issue relating to login when using sub directories.</p>
<p>My Kohana install is in <a href="http://URL/subdir/">http://URL/subdir/</a></p>
<p>In
/classes/useradmin/controller/user.php
[47] $urlPath = ltrim(parse_url($this-&gt;request-&gt;referrer(),PHP_URL_PATH),&#39;/&#39;);</p>
<p>Will return /subdir/controller/action/
which then fails when you try to find the correct controller further down causing an infinite redirection loop.</p>
<p>I replaced it with
$urlPath = ltrim(substr($this-&gt;request-&gt;referrer(), strlen(Url::base(true))),&#39;/&#39;);</p>
<p>Which appears to work.</p>
<p>Dave.</p>
<p><strong><a href="#404" title="2012-01-10 23:04:18">Jan Hohner</a>:</strong> Could it be that you didn&#39;t copy the two routes in init.php? If you didn&#39;t the param is called &#39;id&#39;, if you copied the routes the param is called &#39;provider&#39;.</p>
<p>Cheers,
Jan</p>
<p><strong><a href="#405" title="2012-01-12 18:40:41">trig</a>:</strong> hi Dave, how did you get them working... I&#39;m having same issues with facebook login</p>
<p><strong><a href="#406" title="2012-01-17 23:09:53">Sam</a>:</strong> Is there any place, on github where we could download a working version of useradmin for kohana 3.2. The one from mixu didnt work for 3.1 or 3.2.</p>
<p>Thanks</p>
<p><strong><a href="#407" title="2012-01-19 14:53:45">kenyana</a>:</strong> Anyone with a solution to ErrorException [ Notice ]: Undefined index: max_failed_logins</p>
<p>Its at MODPATHuserclassesuseradminauthorm.php [ 27 ]</p>
<p><strong><a href="#408" title="2012-03-01 16:16:10">Sven Walter</a>:</strong> Is there a 3.2 version out there? i am interested :) could someone send me a copy? big thx!</p>
<p><strong><a href="#409" title="2012-03-07 08:54:36">Matt</a>:</strong> There is a 3.2 version of useradmin on github. Here is the url: <a href="https://github.com/rafsoaken/useradmin/">https://github.com/rafsoaken/useradmin/</a></p>
<p><strong><a href="#410" title="2012-03-27 07:18:22">Cory</a>:</strong> (Caveat: Still noobish to kohana 3.2)</p>
<p>That version doesn&#39;t (quite) seem to be updated for 3.2.  It was relatively easy to set up, but you will still run into some problems with the actions using arguments instead of request-&gt;param( [route parameter] ).</p>
<p>One example is trying to select a provider on the login page. Located in Useradmin_Controller_User::action_provder.</p>
<p>function action_provider($provider_name = null)
{
...</p>
<p>Should be</p>
<p>function action_provider()
{
     $provider_name = $this-&gt;request-&gt;param(&#39;provider&#39;);
...</p>
<p>You can find the params in the routes, which are located in modules/useradmin/init.php</p>
<p><strong><a href="#411" title="2012-04-05 05:13:23">songerph</a>:</strong> Hi can i ask for help? I managed to make most of the useradmin module to work for Kohana 3.1 except for facebook and twitter login/assoc.</p>
<p>Facebook:
When I click either buttons, it sends me to
facebook.com/dialog/oauth?all-parameters-here
with an Error page stating &quot;An error occurred. Please try again later.&quot;</p>
<p>Twitter:
It gives an error regarding certificate problem:</p>
<p>Error fetching remote <a href="https://api.twitter.com/oauth/request_token">https://api.twitter.com/oauth/request_token</a> [ status 0 ] SSL certificate problem, verify that the CA cert is OK. Details: error:14090086:SSL routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed</p>
<p>Anyone got same issues?</p>
<p>TIA.</p>
<p><strong><a href="#412" title="2012-04-16 16:45:22">songerph</a>:</strong> Update:
I managed to get FB login to work by adding &quot;.../user/provider/facebook&quot; in my app&#39;s &quot;Website -&gt; Site URL&quot; info page. Seems like without this my FB login does not continue redirecting. (Or should  the FB login/associate work without this?)</p>
<p>Twitter: Still with the Certificate error</p>
<p><strong><a href="#575" title="2012-08-10 09:10:06">moisha</a>:</strong> Hi Mikito - THXXXX 4 this modul - it&#39;s really what I&#39;ve been looking for.</p>
<p>But there are 2 things that I don&#39;t understand:</p>
<ol>
<li>Is this a problem of kohana auth module, that u can&#39;t say that one page is accessible for login and for admin users?</li>
<li>when i click on a provider (ex. FB) he opens the FB-Login-Page in the same window - have u already tried to implement it via new Window, so that the person stays on the main page?</li>
</ol>
<p>thx</p>
<p><strong><a href="#584" title="2012-09-24 21:44:39">newtophp</a>:</strong> I have configured the module to work with Facebook but I am getting the error below:</p>
<p>&quot;We have successfully retrieved some of the data from your other account, but we were unable to get all the required fields. Please complete form below to register an account.&quot;</p>
<p>Any ideas?</p>
<p><strong><a href="#648" title="2013-02-26 13:16:12">nessa_uepa</a>:</strong> Hi, I am making the changes needed to this module work in Kohana 3.3. I will post it here after i finish.</p>
<p><strong><a href="#652" title="2013-02-27 00:30:58">nessa_uepa</a>:</strong> I just migrated the Useradmin module to Kohana 3.3.0.</p>
<p>I documented the changes in my blog:</p>
<p><a href="http://www.nessauepa.com.br/blog/2013/02/migrating-mixus-useradmin-module-to-kohana-3-3-0/">http://www.nessauepa.com.br/blog/2013/02/migrating-mixus-useradmin-module-to-kohana-3-3-0/</a></p>

    		</section>
    		<footer class="post-footer">
    			<div itemscope itemprop="author" itemtype="http://schema.org/Person" class="post-author">
	                	<img itemprop="image" src="http://www.gravatar.com/avatar/F0AF2953911805542C66FD43B2F8FC38?s=155" alt="Mixu" class="post-author-avatar">
					<div class="post-author-info">
		              	<span itemprop="name">Mixu</span>
		              	<p itemprop="description" class="post-author-bio">Node.js developer</p>
	              	</div>
    			</div>
    		</footer>
		</article>
		
		<section itemprop="comment" class="post-comments">
			<div id="disqus_thread"></div>
			<script type="text/javascript">            
				var disqus_shortname = 'example';
		
			    (function() {
			        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			    })();
			</script>
			<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		</section>	</section>

	<footer class="footer" role="contentinfo">
		<div class="social-links-line"></div>
		<section class="social-links">
	        <div class="social-links-inner">
	        	<a class="icon icon-feed" href="http://localhost:5000/rss/" target="_blank">
	        		<i class="fa fa-rss"></i>
	        	</a>
	        	
	        	<a class="icon icon-twitter" href="http://twitter.com/" target="_blank">				
	        		<i class="fa fa-twitter"></i>
	        	</a>
	        	
	        	<a class="icon icon-facebook" href="http://facebook.com/" target="_blank">
	        		<i class="fa fa-facebook"></i>
	        	</a>
	        	
	        	<a class="icon icon-google-plus" href="http://plus.google.com/" target="_blank">
	        		<i class="fa fa-google-plus"></i>
	        	</a>
	        	
	        	<a class="icon icon-dribbble" href="http://dribbble.com/" target="_blank">
	        		<i class="fa fa-dribbble"></i>
	        	</a>
	        	
	        	<a class="icon icon-flickr" href="http://flickr.com/" target="_blank">
	        		<i class="fa fa-flickr"></i>
	        	</a>
	        	
	        	<a class="icon icon-foursquare" href="http://foursquare.com/" target="_blank">
	        		<i class="fa fa-foursquare"></i>
	        	</a>
	        	
	        	<a class="icon icon-instagram" href="http://instagram.com/" target="_blank">
	        		<i class="fa fa-instagram"></i>
	        	</a>
	        	
	        	<a class="icon icon-github" href="http://github.com/" target="_blank">
	        		<i class="fa fa-github"></i>
	        	</a>
	        	
	        	<a class="icon icon-tumblr" href="http://tumblr.com/" target="_blank">
	        		<i class="fa fa-tumblr"></i>
	        	</a>
	        	
	        	<a class="icon icon-pinterest" href="http://pinterest.com/" target="_blank">
	        		<i class="fa fa-pinterest"></i>
	        	</a>
	        	
	        	<a class="icon icon-linkedin" href="http://linkedin.com/" target="_blank">
	        		<i class="fa fa-linkedin"></i>
	        	</a>
	        	
	        	<a class="icon icon-vk" href="http://vk.com/" target="_blank">
	        		<i class="fa fa-vk"></i>
	        	</a>        </div>               
	    </section>
	</footer></main>

	<script src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/main.min.js"></script>
</body>
</html>