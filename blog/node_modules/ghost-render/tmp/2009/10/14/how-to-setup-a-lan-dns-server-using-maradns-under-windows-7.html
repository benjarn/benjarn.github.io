<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>How to setup a LAN DNS server using MaraDNS under Windows 7</title>	

	<meta name="description" content="">
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="How to setup a LAN DNS server using MaraDNS under Windows 7">
    <meta name="twitter:description" content="">
    <meta name="twitter:site" content="@username">
	<meta name="twitter:creator" content="@username">

    <meta property="og:type" content="article">
    <meta property="og:title" content="How to setup a LAN DNS server using MaraDNS under Windows 7">
    <meta property="og:description" content="">

    <link rel="stylesheet" href="/assets/css/style.css">

    <meta name="generator" content="Ghost ?" />
<link rel="alternate" type="application/rss+xml" title="Mixu&#39;s blog" href="/rss/">
<link rel="canonical" href="http://localhost:5000//2009/10/14/how-to-setup-a-lan-dns-server-using-maradns-under-windows-7.md" />	
</head>
<body class="post-template">
	
<main id="container" role="main">
	<header class="header" role="banner" style="background-image: url(/assets/img/header.jpg);">
		<h1 class="blog-title">
			<a href="http://localhost:5000">Mixu&#x27;s blog</a>
		</h1>
		<div class="blog-description">A blog</div>
	</header>
	<nav class="menu" role="navigation">
		<a href="#">Home</a>
		<span class="delimiter">&#8226;</span>
		<a href="#">About</a>
		<span class="delimiter">&#8226;</span>
		<a href="#">Contacts</a>
	</nav>
	<section class="post-full">
		<article itemscope itemtype="http://schema.org/BlogPosting" role="article" class="post">
			<header class="post-header">        		
    			<h2 itemprop="name headline" class="post-title">
    				<a href="/2009/10/14/how-to-setup-a-lan-dns-server-using-maradns-under-windows-7.html" itemprop="url">How to setup a LAN DNS server using MaraDNS under Windows 7</a>
    			</h2>
    			<div class="post-meta">
        			<time datetime="2009-10-14" itemprop="datePublished">October 14, 2009</time>
        		</div>
        		<hr>
    		</header>
    		<section itemprop="articleBody" class="post-content">
    			<p>Are you tired of using 192.168.0.x to refer to the computers within your LAN? Setting up a DNS server and getting domain names for your local computers is surprisingly easy - even on Windows.</p>
<p><strong>0. Preliminary setup: make sure each computer gets a constant IP address</strong></p>
<p><em>Before setting up the DNS server, you need to ensure that each computer or virtual machine gets a fixed IP address. Otherwise the IP address of the computer may change on each reboot.</em></p>
<p>This should be done on your router, which is usually located either at 192.168.0.1 or 192.168.1.1 (check your current local IP address by running the Command Prompt and &quot;ipconfig&quot;, which shows your current IP address). Check your router manual on instructions how to log in, most routers have a HTTP-based configuration system which can be accessed when connected to the router.</p>
<p>In my case (I have a Asus RT-N11), the address was 192.168.1.1. Make sure that the computers you want to setup IPs for are connected, then find the &quot;Status&quot; or &quot;DHCP Leases&quot; listing on the router web interface. This listing will contain the MAC addresses for each host. Here is mine:</p>
<pre class="hljs"><code><span class="hljs-header">Host Name       MAC Address       IP Address      Lease
--------------------------------------------------------------</span>
HOST1        00-11-22-33-F0-AC 192.168.1.5     60016 secs.
HOST2        00-11-33-44-F2-2C 192.168.1.6     85074 secs.</code></pre><p>A <a href="http://en.wikipedia.org/wiki/MAC_address">MAC address </a>is a unique identifier given to each network adapter. It allows you to setup fixed IPs.</p>
<p>Find the router functionality which allows you to &quot;Assign IP Addresses Manually&quot;. This should enable you to specify a MAC address and a corresponding fixed IP address. Do this for each of the network adapters you wish to have a fixed IP address. On the Asus RT-N11 this was under &quot;IP Config&quot; -&gt; &quot;DHCP Server&quot;.</p>
<p>Add a MAC address &lt;-&gt; IP address pair for each computer.</p>
<p><strong>1. Get MaraDNS </strong></p>
<p>MaraDNS is a free, lightweight and relatively easy-to-configure DNS server for Windows and Linux. <a href="http://www.maradns.org/download.html">Download it from here </a>and unzip it to some folder.</p>
<p><strong>2. Configure MaraDNS</strong></p>
<p>Open &quot;secret.txt&quot; and change the value to something else (random characters).</p>
<p>The MaraDNS configuration is in the &quot;mararc&quot; file in the same directory. <a href="http://en.wikipedia.org/wiki/Name_server">DNS servers </a>have two sets of functionality. They can function as a &quot;Authoritative name server&quot; or a &quot;Recursive/caching name server&quot;.</p>
<p>Authoritative name servers specify IP addresses for domain names. Recursive name servers store information from authoritative name servers and pass on queries in a recursive manner.</p>
<p>We will be configuring both authoritative and recursive functionality in MaraDNS.</p>
<p><strong>2.1 Authoritative configuration</strong></p>
<p>We will configure the server to provide authoritative names of the LAN domain names. Pick any domain, I chose &quot;local.com&quot; (note though that you will not be able to access the actual &quot;local.com&quot; website if you pick an existing domain name).</p>
<p>Add configuration lines to &quot;mararc&quot; like these:</p>
<pre class="hljs"><code>csv2 = <span class="hljs-list">{}</span>
csv2[<span class="hljs-string">&quot;local.com.&quot;</span>] = <span class="hljs-string">&quot;db.lan.txt&quot;</span></code></pre><p>Where <em>local.com </em>is the domain name you picked, and <em>db.lan.txt</em> is the name of the second configuration file which we will be creating next (change it if you want to name the second configuration file).</p>
<p>Create a new file named &quot;db.lan.txt&quot; in the same directory as MaraDNS.</p>
<p>For each of the computers you want to resolve to a name, add a line to &quot;db.lan.txt&quot;. For example, for two machines, one &quot;dev.local.com&quot; and the other &quot;blog.local.com&quot;, add the following lines:</p>
<pre class="hljs"><code>dev.<span class="hljs-preprocessor">%</span>       <span class="hljs-number">192.168.</span><span class="hljs-number">1.4</span> ~
blog.<span class="hljs-preprocessor">%</span>        <span class="hljs-number">192.168.</span><span class="hljs-number">1.6</span> ~</code></pre><p>Done!</p>
<p><strong>2.2 Recursive configuration</strong></p>
<p>We will setup MaraDNS to ask your default name servers for all other domains so that you can resolve all other domain names to their correct IP addresses.</p>
<p>Find out your ISP&#39;s DNS server addresses. These are likely to be listed either on the Router status page, or by checking the details on your network adapter.</p>
<p>Now add your ISP&#39;s DNS servers as upstream servers in &quot;mararc&quot;:</p>
<pre class="hljs"><code>upstream_servers = <span class="hljs-list">{}</span>
upstream_servers[<span class="hljs-string">&quot;.&quot;</span>] = <span class="hljs-string">&quot;xxx.xxx.xxx.xxx, yyy.yyy.yyy.yyy&quot;</span></code></pre><p>Where <em>xxx.xxx.xxx.xxx</em> and <em>yyy.yyy.yyy.yyy </em>are your ISP&#39;s DNS servers.</p>
<p>Done!</p>
<p><strong>3. Run MaraDNS and test it using askmara.exe</strong></p>
<p>Double-click &quot;runmara.bat&quot; , and leave the server running.</p>
<p>Open a command prompt, navigate to the MaraDNS directory and try running:</p>
<pre class="hljs"><code>askmara.<span class="hljs-keyword">exe</span> Agoogle.<span class="hljs-keyword">com</span>.</code></pre><p>and</p>
<pre class="hljs"><code>askmara.<span class="hljs-keyword">exe</span> Ablog.local.<span class="hljs-keyword">com</span>.</code></pre><p>You should get replies like this:</p>
<pre class="hljs"><code><span class="hljs-comment"># Querying the server with the IP 127.0.0.1</span>
<span class="hljs-comment"># Question: Agoogle.com.</span>
google.com. +<span class="hljs-number">300</span> <span class="hljs-operator">a</span> <span class="hljs-number">74.125</span><span class="hljs-number">.67</span><span class="hljs-number">.100</span>
google.com. +<span class="hljs-number">300</span> <span class="hljs-operator">a</span> <span class="hljs-number">74.125</span><span class="hljs-number">.53</span><span class="hljs-number">.100</span>
google.com. +<span class="hljs-number">300</span> <span class="hljs-operator">a</span> <span class="hljs-number">74.125</span><span class="hljs-number">.45</span><span class="hljs-number">.100</span>
<span class="hljs-comment"># NS replies:</span>
<span class="hljs-comment"># AR replies:</span></code></pre><p>and:</p>
<pre class="hljs"><code><span class="hljs-preprocessor"># Querying the server with the IP 127.0.0.1</span>
<span class="hljs-preprocessor"># Question: Ablog.local.com.</span>
blog.local.com. +<span class="hljs-number">86400</span> a <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.6</span>
<span class="hljs-preprocessor"># NS replies:</span>
<span class="hljs-preprocessor">#local.com. +86400 ns synth-ip-7f000001.local.com.</span>
<span class="hljs-preprocessor"># AR replies:</span>
<span class="hljs-preprocessor">#synth-ip-7f000001.local.com. +86400 a 127.0.0.1</span></code></pre><p>If you get problems with the first query, you messed up the recursive DNS settings (are your ISP DNS server addresses correct?), and if you get an error with the second query, you messed up the authoritative settings.</p>
<p><strong>4. Change MaraDNS to reply to queries from your LAN</strong></p>
<p>Shutdown the MaraDNS window, and change the first two lines of &quot;mararc&quot; to something like:</p>
<pre class="hljs"><code><span class="hljs-title">ipv4_bind_addresses</span> = <span class="hljs-string">&quot;192.168.1.2
recursive_acl = &quot;</span><span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">24</span><span class="hljs-string">&quot;</span></code></pre><p>Where 192.168.1.2 is the IP address of the computer on which the server will be running and the &quot;192.168.1&quot; part of recursive_acl is the same as on your network (might be 192.168.0.0/24).</p>
<p>Start MaraDNS again, and leave it running.</p>
<p><strong>5. Setup your router to hand out your new DNS server</strong></p>
<p>Open your router&#39;s web interface and find the DHCP server settings. There should be an option to set up a DNS server. Write the IP address of the computer on which the DNS server will be running.</p>
<p>For each of your computers, disconnect the network (e.g. by disabling and enabling it in Windows, or by using &quot;ifconfig eth0 down&quot;/&quot;ifconfig eth0 up&quot; on Linux).</p>
<p>That&#39;s it, you should now be able to refer to your LAN computers by their domain names.</p>
<h2 id="comments">Comments</h2>
<p><strong><a href="#52" title="2009-11-21 18:08:52">Maxime</a>:</strong> I love reading through your blog, I wanted to leave a little comment to support you and wish you a good continuation, or when I read your lines I found your article very interested, thank you for sharing.</p>
<p><strong><a href="#53" title="2009-11-23 08:30:35">rancell</a>:</strong> Eighty percent of success is showing up.</p>
<p><strong><a href="#54" title="2010-01-03 18:04:31">Computer Gamers</a>:</strong> My cousin would really appreciate this blog post. We were just talking about this. hehe</p>
<p><strong><a href="#55" title="2010-03-14 16:35:48">P1 Linda</a>:</strong> Many thanks for telling. I haven&#39;t really have time to understand this yet still I&#39;ve bookmarked it so that I will be able to read it later on.</p>
<p><strong><a href="#56" title="2010-03-21 21:06:21">Blondell Gonzalaz</a>:</strong> Good day I just wanted to know on if you could write another post to go a bit further into detail on the topic? This one was great but I would love to hear more!</p>
<p><strong><a href="#57" title="2010-04-07 17:45:22">Randi Gapinski</a>:</strong> Very interesting. I&#39;ve subscribed to your feed.</p>
<p><strong><a href="#58" title="2010-05-04 06:36:21">Kylee Stuckemeyer</a>:</strong> Morning, It is nice to stumble upon a good website like this one. Do you mind if I use some of the information here, and I&#39;ll leave a link back to your site?</p>
<p><strong><a href="#59" title="2010-06-16 12:09:52">Virtual Crowds</a>:</strong> <strong>DNS Verification FTW...</strong></p>
<p>I found your entry very interesting so I&#39;ve added a Trackback to it on my weblog. Hope you like that... :)...</p>
<p><strong><a href="#60" title="2010-09-06 09:10:43">Mr Lapin</a>:</strong> Unlike the comments above, this one is not spam. :-)</p>
<p>Kudos, Mixu.  Thanks to this well-written cookbook, I was able to implement a lan dns server on an ancient Win98 laptop.  The only change I had to make was removing the start and exit commands from the batch script that starts the server.</p>
<p>This works great.  I appreciate your taking time to provide the entry.</p>
<p><strong><a href="#61" title="2010-09-06 09:54:06">Mikito Takada</a>:</strong> Thanks for the nice comments! They keep me motivated to write :)</p>
<p><strong><a href="#62" title="2010-12-08 13:33:51">Paul Heckles</a>:</strong> Hi, a very good blog indeed exactly what I was looking for - almost!  I am also trying use the internal DNS server I have set up as an internet name server i.e. I have used DYNDNS to create a static hostname for my router, then I have updated the nameserver on my domain provider to the static hostname, now I need to forward nameserver requests from my router to my internal DNS server, can this be done with a router firwall forwarding rule?  Many thanks</p>
<p><strong><a href="#63" title="2011-08-29 18:53:30">Mikkell</a>:</strong> Upstream_servers no longer supported</p>

    		</section>
    		<footer class="post-footer">
    			<div itemscope itemprop="author" itemtype="http://schema.org/Person" class="post-author">
	                	<img itemprop="image" src="http://www.gravatar.com/avatar/F0AF2953911805542C66FD43B2F8FC38?s=155" alt="Mixu" class="post-author-avatar">
					<div class="post-author-info">
		              	<span itemprop="name">Mixu</span>
		              	<p itemprop="description" class="post-author-bio">Node.js developer</p>
	              	</div>
    			</div>
    		</footer>
		</article>
		
		<section itemprop="comment" class="post-comments">
			<div id="disqus_thread"></div>
			<script type="text/javascript">            
				var disqus_shortname = 'example';
		
			    (function() {
			        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			    })();
			</script>
			<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		</section>	</section>

	<footer class="footer" role="contentinfo">
		<div class="social-links-line"></div>
		<section class="social-links">
	        <div class="social-links-inner">
	        	<a class="icon icon-feed" href="http://localhost:5000/rss/" target="_blank">
	        		<i class="fa fa-rss"></i>
	        	</a>
	        	
	        	<a class="icon icon-twitter" href="http://twitter.com/" target="_blank">				
	        		<i class="fa fa-twitter"></i>
	        	</a>
	        	
	        	<a class="icon icon-facebook" href="http://facebook.com/" target="_blank">
	        		<i class="fa fa-facebook"></i>
	        	</a>
	        	
	        	<a class="icon icon-google-plus" href="http://plus.google.com/" target="_blank">
	        		<i class="fa fa-google-plus"></i>
	        	</a>
	        	
	        	<a class="icon icon-dribbble" href="http://dribbble.com/" target="_blank">
	        		<i class="fa fa-dribbble"></i>
	        	</a>
	        	
	        	<a class="icon icon-flickr" href="http://flickr.com/" target="_blank">
	        		<i class="fa fa-flickr"></i>
	        	</a>
	        	
	        	<a class="icon icon-foursquare" href="http://foursquare.com/" target="_blank">
	        		<i class="fa fa-foursquare"></i>
	        	</a>
	        	
	        	<a class="icon icon-instagram" href="http://instagram.com/" target="_blank">
	        		<i class="fa fa-instagram"></i>
	        	</a>
	        	
	        	<a class="icon icon-github" href="http://github.com/" target="_blank">
	        		<i class="fa fa-github"></i>
	        	</a>
	        	
	        	<a class="icon icon-tumblr" href="http://tumblr.com/" target="_blank">
	        		<i class="fa fa-tumblr"></i>
	        	</a>
	        	
	        	<a class="icon icon-pinterest" href="http://pinterest.com/" target="_blank">
	        		<i class="fa fa-pinterest"></i>
	        	</a>
	        	
	        	<a class="icon icon-linkedin" href="http://linkedin.com/" target="_blank">
	        		<i class="fa fa-linkedin"></i>
	        	</a>
	        	
	        	<a class="icon icon-vk" href="http://vk.com/" target="_blank">
	        		<i class="fa fa-vk"></i>
	        	</a>        </div>               
	    </section>
	</footer></main>

	<script src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/main.min.js"></script>
</body>
</html>