<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Kohana3: Setting up phpUnit and phpDocumentor</title>	

	<meta name="description" content="">
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Kohana3: Setting up phpUnit and phpDocumentor">
    <meta name="twitter:description" content="">
    <meta name="twitter:site" content="@username">
	<meta name="twitter:creator" content="@username">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Kohana3: Setting up phpUnit and phpDocumentor">
    <meta property="og:description" content="">

    <link rel="stylesheet" href="/assets/css/style.css">

    <meta name="generator" content="Ghost ?" />
<link rel="alternate" type="application/rss+xml" title="Mixu&#39;s blog" href="/rss/">
<link rel="canonical" href="http://localhost:5000//2010/07/25/kohana3-setting-up-phpunit-and-phpdocumentor.md" />	
</head>
<body class="post-template">
	
<main id="container" role="main">
	<header class="header" role="banner" style="background-image: url(/assets/img/header.jpg);">
		<h1 class="blog-title">
			<a href="http://localhost:5000">Mixu&#x27;s blog</a>
		</h1>
		<div class="blog-description">A blog</div>
	</header>
	<nav class="menu" role="navigation">
		<a href="#">Home</a>
		<span class="delimiter">&#8226;</span>
		<a href="#">About</a>
		<span class="delimiter">&#8226;</span>
		<a href="#">Contacts</a>
	</nav>
	<section class="post-full">
		<article itemscope itemtype="http://schema.org/BlogPosting" role="article" class="post">
			<header class="post-header">        		
    			<h2 itemprop="name headline" class="post-title">
    				<a href="/2010/07/25/kohana3-setting-up-phpunit-and-phpdocumentor.html" itemprop="url">Kohana3: Setting up phpUnit and phpDocumentor</a>
    			</h2>
    			<div class="post-meta">
        			<time datetime="2010-07-25" itemprop="datePublished">July 25, 2010</time>
        		</div>
        		<hr>
    		</header>
    		<section itemprop="articleBody" class="post-content">
    			<p>Here is my quick guide on how to setup <a href="http://www.phpunit.de/manual/3.4/en/index.html">phpUnit</a> and <a href="http://manual.phpdoc.org/HTMLframesConverter/default/">phpDoc </a>for <a href="http://kohanaframework.org/">Kohana 3</a>.</p>
<p><h2>phpUnit</h2></p>
<p><h3>1. Setup</h3>
Install phpUnit using pear:</p>
<pre class="hljs"><code><span class="hljs-title">pear</span> install phpunit</code></pre><p>(See the PEAR site for <a href="http://pear.php.net/manual/en/installation.getting.php">how to install PEAR</a>.)
Get the Kohana unittest module from <a href="http://github.com/kohana/unittest">http://github.com/kohana/unittest</a>. If you aren&#39;t using git for your repo, just clone the files (<code>git clone <a href="http://github.com/kohana/unittest.git">http://github.com/kohana/unittest.git</a></code>), get rid of the .git subdirectories and copy the module to your modules/ directory.</p>
<p><a href="http://github.com/kohana/unittest">Follow the setup instructions on GitHub</a>. Some tips:</p>
<p>It may be easiest to define an alternative default database configuration, since currently unittest does not automatically change any of the database configurations (ex. in models). Since I use a Fedora VM for development but prefer to run tests on Windows, I added the following logic to config/database.php:</p>
<p><pre lang="php">if (strtoupper(substr(PHP_OS, 0, 3)) === &#39;WIN&#39;) {
return array(&#39;default&#39; =&gt; ..test config..);
} else {
return array(&#39;default&#39; =&gt; ..normal config..);
}</pre>
I did the same thing in bootstrap.php, selectively enabling the unittest module and changing the cache dir based on the OS. You can probably think of some way to do the same in your setup even if you aren&#39;t using a different OS for serving HTTP requests.</p>
<p><h3>2. Creating tests</h3>
Tests for application files go into the application/tests/ folder you create.</p>
<p>Tests for any module (inc. application, database, unittest etc.) go in the &#39;tests&#39; folder in the module.</p>
<p>Tests extend Kohana_Unittest_TestCase, not PHPUnit_Framework_TestCase.</p>
<p>To group individual tests into modules you need to add the tests to a group for that module. The convention for group names is modules.{module_name}. This is done using the docblock @group specification (can have multiple group specifications). See <a href="http://github.com/kohana/unittest/blob/master/guide/unittest.testing.md">Writing Tests in the repo on GitHub</a>.</p>
<p><h3>3. Fixtures</h3>
The easiest way to create fixtures is to use setUp() to set the DB, then tearDown() to clean up. You can just use the DB class, or use ORM to add the records. Example:</p>
<p><pre lang="php">class WhateverTest extends Kohana_Unittest_TestCase {
   function setUp() {
      // setup the DB
      DB::query(NULL, &quot;TRUNCATE <code>kohana_test</code>.<code>whatever</code>;&quot;)-&gt;execute();
      $fixture_rows = array(
          array(
            &#39;key&#39; =&gt; &#39;billing_key&#39;,
            &#39;value&#39; =&gt; &#39;0&#39;,
          ),
      );
      // add the necessary items
      foreach($fixture_rows as $row) {
         DB::insert(&#39;whatever&#39;, array_keys($row))-&gt;values(array_values($row))-&gt;execute();
      }
   }
   function tearDown() {
   }</pre>
There is probably a better way using a proper fixture class, but I haven&#39;t seen one for Kohana yet.</p>
<p><h3>4. Execution</h3>
You will need to specify the path to the KO3 webroot index.php as the bootstrap for phpUnit. This is because the dependencies which your code has need to be loaded by Kohana.</p>
<p>By default, all tests in application/tests/ will be run.</p>
<pre class="hljs"><code>phpunit <span class="hljs-comment">--bootstrap=index.php ./modules/unittest/tests.php</span></code></pre><p>To run a specific group of tests on the cli add --group {groupname.in.testfile} between the --bootstrap switch and the path to the tests folder.</p>
<pre class="hljs"><code>phpunit --bootstrap=<span class="hljs-keyword">index</span>.php --<span class="hljs-keyword">group</span> groupname.<span class="hljs-keyword">in</span>.testfile ./modules/unittest/tests.php</code></pre><p><h2>phpDocumentor</h2>
Install phpDocumentor using PEAR: <code>pear install phpDocumentor</code>.</p>
<p>On Windows, if you use paths with spaces in them it is easiest to make sure that phpDocumentor is in the php include path (edit php.ini if necessary), and invoke php while passing the phpdoc file directly (see below for example).</p>
<p>You will probably only want to generate API docs for application/, perhaps selectively adding a few modules. And you probably want to exclude: application/vendor/, application/logs/, application/views/, application/bootstrap.php and application/config/ from the API documentation.</p>
<p>Remember that <a href="http://blog.mixu.net/2009/09/09/phpdocumentor-1-4-3-gotchas/">phpDocumentor does not support multiple option specifications</a>: you have to join the paths with a comma. Furthermore, remember to have the directory separator character at the end of directories to trigger the correct interpretation.</p>
<p>Kohana3 uses a number of custom tags, so you will want to exclude those. Here is a sample run:</p>
<pre class="hljs"><code>php <span class="hljs-string">&quot;c:Program Files (x86)PEARphpdoc&quot;</span> --directory application/
--ignore application<span class="hljs-regexp">/vendor/</span>,application<span class="hljs-regexp">/logs/</span>,application<span class="hljs-regexp">/views/</span>,application<span class="hljs-regexp">/bootstrap.php,application/config/</span> --target doc/api
--customtags type,<span class="hljs-reserved">default</span>,constructor,chainable,<span class="hljs-class"><span class="hljs-keyword">class</span>,<span class="hljs-title">namespace</span>,<span class="hljs-title">module</span>,<span class="hljs-title">group</span></span></code></pre><p>There are a few options that may also prove useful:
--parseprivate causes private methods to be shown
--output HTML:frames:earthli changes the output to earthli, which I like.
--undocumentedelements Adds warnings to errors.html for undocumented elements.</p>
<h2 id="comments">Comments</h2>
<p><strong><a href="#243" title="2011-06-14 17:08:19">Willian</a>:</strong> Thank you very much. It&#39;s hard to find this kind of thing ...</p>

    		</section>
    		<footer class="post-footer">
    			<div itemscope itemprop="author" itemtype="http://schema.org/Person" class="post-author">
	                	<img itemprop="image" src="http://www.gravatar.com/avatar/F0AF2953911805542C66FD43B2F8FC38?s=155" alt="Mixu" class="post-author-avatar">
					<div class="post-author-info">
		              	<span itemprop="name">Mixu</span>
		              	<p itemprop="description" class="post-author-bio">Node.js developer</p>
	              	</div>
    			</div>
    		</footer>
		</article>
		
		<section itemprop="comment" class="post-comments">
			<div id="disqus_thread"></div>
			<script type="text/javascript">            
				var disqus_shortname = 'example';
		
			    (function() {
			        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			    })();
			</script>
			<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		</section>	</section>

	<footer class="footer" role="contentinfo">
		<div class="social-links-line"></div>
		<section class="social-links">
	        <div class="social-links-inner">
	        	<a class="icon icon-feed" href="http://localhost:5000/rss/" target="_blank">
	        		<i class="fa fa-rss"></i>
	        	</a>
	        	
	        	<a class="icon icon-twitter" href="http://twitter.com/" target="_blank">				
	        		<i class="fa fa-twitter"></i>
	        	</a>
	        	
	        	<a class="icon icon-facebook" href="http://facebook.com/" target="_blank">
	        		<i class="fa fa-facebook"></i>
	        	</a>
	        	
	        	<a class="icon icon-google-plus" href="http://plus.google.com/" target="_blank">
	        		<i class="fa fa-google-plus"></i>
	        	</a>
	        	
	        	<a class="icon icon-dribbble" href="http://dribbble.com/" target="_blank">
	        		<i class="fa fa-dribbble"></i>
	        	</a>
	        	
	        	<a class="icon icon-flickr" href="http://flickr.com/" target="_blank">
	        		<i class="fa fa-flickr"></i>
	        	</a>
	        	
	        	<a class="icon icon-foursquare" href="http://foursquare.com/" target="_blank">
	        		<i class="fa fa-foursquare"></i>
	        	</a>
	        	
	        	<a class="icon icon-instagram" href="http://instagram.com/" target="_blank">
	        		<i class="fa fa-instagram"></i>
	        	</a>
	        	
	        	<a class="icon icon-github" href="http://github.com/" target="_blank">
	        		<i class="fa fa-github"></i>
	        	</a>
	        	
	        	<a class="icon icon-tumblr" href="http://tumblr.com/" target="_blank">
	        		<i class="fa fa-tumblr"></i>
	        	</a>
	        	
	        	<a class="icon icon-pinterest" href="http://pinterest.com/" target="_blank">
	        		<i class="fa fa-pinterest"></i>
	        	</a>
	        	
	        	<a class="icon icon-linkedin" href="http://linkedin.com/" target="_blank">
	        		<i class="fa fa-linkedin"></i>
	        	</a>
	        	
	        	<a class="icon icon-vk" href="http://vk.com/" target="_blank">
	        		<i class="fa fa-vk"></i>
	        	</a>        </div>               
	    </section>
	</footer></main>

	<script src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/main.min.js"></script>
</body>
</html>