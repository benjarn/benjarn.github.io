<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Mercurial tips for developers: subrepositories, finding a deleted file and a lot more</title>	

	<meta name="description" content="">
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Mercurial tips for developers: subrepositories, finding a deleted file and a lot more">
    <meta name="twitter:description" content="">
    <meta name="twitter:site" content="@username">
	<meta name="twitter:creator" content="@username">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Mercurial tips for developers: subrepositories, finding a deleted file and a lot more">
    <meta property="og:description" content="">

    <link rel="stylesheet" href="/assets/css/style.css">

    <meta name="generator" content="Ghost ?" />
<link rel="alternate" type="application/rss+xml" title="Mixu&#39;s blog" href="/rss/">
<link rel="canonical" href="http://localhost:5000//2010/08/04/mercurial-tips-for-developers-subrepositories-finding-a-deleted-file-and-a-lot-more.md" />	
</head>
<body class="post-template">
	
<main id="container" role="main">
	<header class="header" role="banner" style="background-image: url(/assets/img/header.jpg);">
		<h1 class="blog-title">
			<a href="http://localhost:5000">Mixu&#x27;s blog</a>
		</h1>
		<div class="blog-description">A blog</div>
	</header>
	<nav class="menu" role="navigation">
		<a href="#">Home</a>
		<span class="delimiter">&#8226;</span>
		<a href="#">About</a>
		<span class="delimiter">&#8226;</span>
		<a href="#">Contacts</a>
	</nav>
	<section class="post-full">
		<article itemscope itemtype="http://schema.org/BlogPosting" role="article" class="post">
			<header class="post-header">        		
    			<h2 itemprop="name headline" class="post-title">
    				<a href="/2010/08/04/mercurial-tips-for-developers-subrepositories-finding-a-deleted-file-and-a-lot-more.html" itemprop="url">Mercurial tips for developers: subrepositories, finding a deleted file and a lot more</a>
    			</h2>
    			<div class="post-meta">
        			<time datetime="2010-08-04" itemprop="datePublished">August 04, 2010</time>
        		</div>
        		<hr>
    		</header>
    		<section itemprop="articleBody" class="post-content">
    			<p>Here are my Mercurial tips for individual developers:</p>
<h2>Basic configuration</h2>
<strong>Linux with Gnome</strong>

<code>ini
[ui]
username = Firstname Surname &amp;lt;firstname.surname@gmail.com&amp;gt;
merge = meld
[extensions]
hgext.extdiff=
hgext.bookmarks =
hggit =
[extdiff]
cmd.vdiff = meld
&lt;span style=&quot;font-family: Georgia, &#39;Times New Roman&#39;, &#39;Bitstream Charter&#39;, Times, serif; font-size: 13px; line-height: 19px; white-space: normal;&quot;&gt;[/codesyntax]&lt;/span&gt;</code>

<strong>MacOSX</strong>

See <a href="http://mercurial.selenic.com/wiki/MacOSXFileMerge">this guide</a>.

<strong>Windows</strong>

Use WinMerge.
<h2>Find a deleted file</h2>

<pre class="hljs"><code>hg log --<span class="hljs-keyword">template</span> <span class="hljs-string">&quot;{rev}: {file_dels}n&quot;</span></code></pre><p>Using find in Windows:</p>
<pre class="hljs"><code>hg log --<span class="hljs-keyword">template</span> <span class="hljs-string">&quot;{rev}: {file_dels}n&quot;</span> | find /n <span class="hljs-string">&quot;filename&quot;</span></code></pre><p>(From <a href="http://stackoverflow.com/questions/1013550/find-deleted-files-in-mercurial-repository-history-quickly">Stackoverflow</a>.)</p>
<p><h2>Useful variations of basic commands</h2>
<strong>General options</strong></p>
<p>Most hg commands support the --dry-run parameter which is useful for testing what would happen without actually doing anything:</p>
<pre class="hljs"><code>-n, --dry-run (<span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> perform actions, just <span class="hljs-built_in">print</span> output)</code></pre><p><strong>Log and status commands</strong></p>
<pre class="hljs"><code>hg <span class="hljs-built_in">log</span> -<span class="hljs-keyword">r</span> tip (tip changelog)
hg <span class="hljs-built_in">log</span> -<span class="hljs-keyword">l</span> <span class="hljs-number">5</span> (<span class="hljs-keyword">last</span> <span class="hljs-number">5</span> changelog statuses)
hg status -<span class="hljs-keyword">m</span> (show modified <span class="hljs-keyword">files</span> <span class="hljs-keyword">only</span>)
hg status -<span class="hljs-keyword">r</span> (show removed <span class="hljs-keyword">files</span> <span class="hljs-keyword">only</span>)
hg status -<span class="hljs-keyword">a</span> (show added <span class="hljs-keyword">files</span> <span class="hljs-keyword">only</span>)</code></pre><p><strong>Add, remove, file renames (addremove)</strong></p>
<pre class="hljs"><code>hg <span class="hljs-built_in">remove</span> --after (<span class="hljs-keyword">mark</span> <span class="hljs-keyword">all</span> deleted <span class="hljs-keyword">files</span> <span class="hljs-keyword">as</span> really removed)
hg addremove --similarity <span class="hljs-number">100</span>
(automatically detect <span class="hljs-keyword">files</span> that are <span class="hljs-number">100</span>% similar <span class="hljs-keyword">as</span> renamed)</code></pre><p><strong>Commit, push, pull</strong></p>
<pre class="hljs"><code>hg commit -m <span class="hljs-string">&quot;commit message&quot;</span> (commit <span class="hljs-keyword">without</span> triggering <span class="hljs-operator">the</span> editor)
hg push <span class="hljs-comment">--debug -v ssh://hg@bitbucket.org/usernamehere/reponamehere</span>
(verbose output <span class="hljs-keyword">for</span> <span class="hljs-operator">a</span> push <span class="hljs-built_in">to</span> deter <span class="hljs-operator">the</span> impatient <span class="hljs-built_in">from</span> cancelling)</code></pre><p><strong>Grep</strong></p>
<pre class="hljs"><code><span class="hljs-title">hg</span> grep PATTERN</code></pre><p>By default, grep only prints output for the first revision of a file in which it finds a match:</p>
<pre class="hljs"><code><span class="hljs-subst">--</span><span class="hljs-literal">all</span>    print <span class="hljs-literal">all</span> revisions that <span class="hljs-keyword">match</span> <span class="hljs-literal">and</span>
<span class="hljs-attribute">-i</span>, <span class="hljs-subst">--</span>ignore<span class="hljs-attribute">-case</span> <span class="hljs-keyword">to</span> ignore <span class="hljs-keyword">case</span></code></pre><p><strong>Reverting to an old revision</strong></p>
<p>Use <em>update </em>to do this for the whole repository:</p>
<pre class="hljs"><code><span class="hljs-title">hg</span> update -r REVISION</code></pre><p>If you are fine with clobbering the existing files, use:</p>
<pre class="hljs"><code><span class="hljs-title">hg</span> update -C REVISION</code></pre><p>Use <em>revert</em> to do this for an individual file:</p>
<pre class="hljs"><code><span class="hljs-title">hg</span> revert -r REVISION FILENAME</code></pre><p>You can also use -d to revert or update to the version that was last committed on a particular date.</p>
<p><h2>Implementing subrepositories</h2>
Subrepositories are useful for things like libraries within a project, if you want to maintain a library repo separately from the rest of the code.</p>
<p>There are three different options for working with subrepositories:</p>
<p><ol>
    <li>Use the subrepos functionality built into Mercurial.</p>
<p><ul>
    <li>Pros: built in.</li>
    <li>Cons: sparsely documented and not feature-complete (see <a href="http://mercurial.selenic.com/wiki/subrepos#Caveats">Caveats here</a>).</li>
    <li>Link: <a href="http://stackoverflow.com/questions/2083393/mercurial-subrepos-how-do-you-create-them-and-how-do-they-work">http://stackoverflow.com/questions/2083393/mercurial-subrepos-how-do-you-create-them-and-how-do-they-work</a></li>
</ul>
</li>
    <li>Use <a href="http://en.wikipedia.org/wiki/Symbolic_link">symlinks</a>.</p>
<p><ul>
    <li>Pros: uses core Mercurial features, built into OS (Linuxes but also Windows), possibly more flexible than normal solution, Mercurial will treat symlinked directories just like regular directories.</li>
    <li>Cons: Mercurial will treat symlinked directories just like regular directories.</li>
</ul>
</li>
    <li>Use a bash script and an ignore file to create subrepos.</p>
<p><ul>
    <li>Pros: uses core Mercurial features.</li>
    <li>Cons: script involves renaming stuff temporarily.</li>
    <li>Link: <a href="http://rustyklophaus.com/articles/20100124-SubmodulesAndSubreposDoneRight.html">http://rustyklophaus.com/articles/20100124-SubmodulesAndSubreposDoneRight.html</a></li>
</ul>
</li>
</ol>
I chose the second alternative: using symlinks to link folders in subrepos to the main repository.</p>
<p><strong>How to setup the symbolic links:</strong></p>
<p>You can do this simply by moving the library files to another directory, starting a new repo (if you want the history, see the next tip) and then creating <a href="http://en.wikipedia.org/wiki/Symbolic_link">symlinks </a> from the original location back to the new repository location. On Windows, you can use <a href="http://www.rekenwonder.com/linkmagic.htm">Junction Link Magic </a>for the symbolic links.</p>
<p><strong>Benefits:</strong></p>
<p>The main benefit is that I can flexibly select a couple of key directories to include in the main project, while keeping the side project with its own repo.</p>
<p>The main repository will store the subrepo files as they were at the time of commit, and subrepository can have more detailed history than main repository. This has the benefit of being able to store the state of the whole project, while still doing more granular updates on the subrepo between main repo commits.</p>
<p><h2>Separating libraries to their own directories using the convert extension</h2>
<a href="http://hgtip.com/tips/advanced/2009-11-16-using-convert-to-decompose-your-repository/  ">http://hgtip.com/tips/advanced/2009-11-16-using-convert-to-decompose-your-repository/</a></p>
<p><h2>Creating a git mirror</h2>
<a href="http://hgtip.com/tips/advanced/2009-11-09-create-a-git-mirror/  ">http://hgtip.com/tips/advanced/2009-11-09-create-a-git-mirror/</a></p>
<p><h2>Configuring bitbucket</h2>
<a href="http://hgtip.com/tips/advanced/2009-11-09-create-a-git-mirror/  ">http://hgtip.com/tips/advanced/2009-10-01-configuring-user-auth-https/</a></p>
<p><h2>Detecting renames automatically</h2>
<a href="http://hgtip.com/tips/advanced/2009-09-30-detecting-renames-automatically/">http://hgtip.com/tips/advanced/2009-09-30-detecting-renames-automatically/</a></p>

    		</section>
    		<footer class="post-footer">
    			<div itemscope itemprop="author" itemtype="http://schema.org/Person" class="post-author">
	                	<img itemprop="image" src="http://www.gravatar.com/avatar/F0AF2953911805542C66FD43B2F8FC38?s=155" alt="Mixu" class="post-author-avatar">
					<div class="post-author-info">
		              	<span itemprop="name">Mixu</span>
		              	<p itemprop="description" class="post-author-bio">Node.js developer</p>
	              	</div>
    			</div>
    		</footer>
		</article>
		
		<section itemprop="comment" class="post-comments">
			<div id="disqus_thread"></div>
			<script type="text/javascript">            
				var disqus_shortname = 'example';
		
			    (function() {
			        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			    })();
			</script>
			<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		</section>	</section>

	<footer class="footer" role="contentinfo">
		<div class="social-links-line"></div>
		<section class="social-links">
	        <div class="social-links-inner">
	        	<a class="icon icon-feed" href="http://localhost:5000/rss/" target="_blank">
	        		<i class="fa fa-rss"></i>
	        	</a>
	        	
	        	<a class="icon icon-twitter" href="http://twitter.com/" target="_blank">				
	        		<i class="fa fa-twitter"></i>
	        	</a>
	        	
	        	<a class="icon icon-facebook" href="http://facebook.com/" target="_blank">
	        		<i class="fa fa-facebook"></i>
	        	</a>
	        	
	        	<a class="icon icon-google-plus" href="http://plus.google.com/" target="_blank">
	        		<i class="fa fa-google-plus"></i>
	        	</a>
	        	
	        	<a class="icon icon-dribbble" href="http://dribbble.com/" target="_blank">
	        		<i class="fa fa-dribbble"></i>
	        	</a>
	        	
	        	<a class="icon icon-flickr" href="http://flickr.com/" target="_blank">
	        		<i class="fa fa-flickr"></i>
	        	</a>
	        	
	        	<a class="icon icon-foursquare" href="http://foursquare.com/" target="_blank">
	        		<i class="fa fa-foursquare"></i>
	        	</a>
	        	
	        	<a class="icon icon-instagram" href="http://instagram.com/" target="_blank">
	        		<i class="fa fa-instagram"></i>
	        	</a>
	        	
	        	<a class="icon icon-github" href="http://github.com/" target="_blank">
	        		<i class="fa fa-github"></i>
	        	</a>
	        	
	        	<a class="icon icon-tumblr" href="http://tumblr.com/" target="_blank">
	        		<i class="fa fa-tumblr"></i>
	        	</a>
	        	
	        	<a class="icon icon-pinterest" href="http://pinterest.com/" target="_blank">
	        		<i class="fa fa-pinterest"></i>
	        	</a>
	        	
	        	<a class="icon icon-linkedin" href="http://linkedin.com/" target="_blank">
	        		<i class="fa fa-linkedin"></i>
	        	</a>
	        	
	        	<a class="icon icon-vk" href="http://vk.com/" target="_blank">
	        		<i class="fa fa-vk"></i>
	        	</a>        </div>               
	    </section>
	</footer></main>

	<script src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/main.min.js"></script>
</body>
</html>